import{_ as s,c as i,o as a,a4 as n}from"./chunks/framework.uKVmtqZI.js";const h="/assets/%E3%80%90%E6%89%8B%E7%BB%98%E7%89%88%E3%80%91Socket%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.B8eysd1J.png",k="/assets/Namespace%E6%A8%A1%E5%9E%8B.2tXy49Fe.png",l="/assets/Rooms%E6%A8%A1%E5%9E%8B.BO2SGX1-.png",t="/assets/%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%9E%8B.DKOAT6Wx.png",p="/assets/%E3%80%90%E6%89%8B%E7%BB%98%E7%89%88%E3%80%91Netty-SocketIO%E6%9E%B6%E6%9E%84%E7%BB%93%E6%9E%84%E5%9B%BE.B9T821Hx.png",e="/assets/image-20220110100419100.B-ewaWHT.png",E="/assets/image-20220110100458492.eXOfwlr4.png",r="/assets/image-20220110100547318.BdDMuk80.png",d="/assets/image-20220110140642844.BIQ8Bsx2.png",g="/assets/image-20220110095728724.hLqG0xjB.png",y="/assets/image-20221011095129953.D4-d8j_C.png",c="/assets/image-20220624150923335.hUnVLqCs.png",o="/assets/%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90.-8a4agCO.png",F="/assets/%E6%80%BB%E4%BD%93%E4%BA%A4%E4%BA%92%E6%97%B6%E5%BA%8F%E8%AE%BE%E8%AE%A1.BgootgzV.png",A="/assets/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E4%BA%8B%E4%BE%8B.BtnmrnsN.png",_=JSON.parse('{"title":"ä¸€ç§åŸºäºNetty-SocketIOå®ç°åŒå‘å®æ—¶é€šä¿¡çš„æ–¹æ¡ˆ","description":"","frontmatter":{"head":[["link",{"rel":"stylesheet","href":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"}]]},"headers":[],"relativePath":"æŠ€æœ¯ç±»ç»éªŒåˆ†äº«/ä¸€ç§åŸºäºNetty-SocketIOå®ç°çš„åŒå‘å®æ—¶é€šä¿¡æ–¹æ¡ˆ.md","filePath":"æŠ€æœ¯ç±»ç»éªŒåˆ†äº«/ä¸€ç§åŸºäºNetty-SocketIOå®ç°çš„åŒå‘å®æ—¶é€šä¿¡æ–¹æ¡ˆ.md"}'),D={name:"æŠ€æœ¯ç±»ç»éªŒåˆ†äº«/ä¸€ç§åŸºäºNetty-SocketIOå®ç°çš„åŒå‘å®æ—¶é€šä¿¡æ–¹æ¡ˆ.md"},C=n('<h1 id="ä¸€ç§åŸºäºnetty-socketioå®ç°åŒå‘å®æ—¶é€šä¿¡çš„æ–¹æ¡ˆ" tabindex="-1">ä¸€ç§åŸºäºNetty-SocketIOå®ç°åŒå‘å®æ—¶é€šä¿¡çš„æ–¹æ¡ˆ <a class="header-anchor" href="#ä¸€ç§åŸºäºnetty-socketioå®ç°åŒå‘å®æ—¶é€šä¿¡çš„æ–¹æ¡ˆ" aria-label="Permalink to &quot;ä¸€ç§åŸºäºNetty-SocketIOå®ç°åŒå‘å®æ—¶é€šä¿¡çš„æ–¹æ¡ˆ&quot;">â€‹</a></h1><h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-label="Permalink to &quot;å‰è¨€&quot;">â€‹</a></h2><p>å‰åç«¯æ•°æ®äº¤äº’ä¸­é™¤äº†ä¸»åŠ¨çš„<code>Http</code>è¯·æ±‚ä»¥å¤–ï¼Œä¹Ÿç»å¸¸ä¼šæœ‰ä¸€äº›ä¸šåŠ¡éœ€è¦åç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™å‰ç«¯ï¼Œè€Œç›®å‰ä¸šå†…ä¸»æµçš„æŠ€æœ¯æ ˆä¸€èˆ¬å°±æ˜¯<code>WebSocket</code>æŠ€æœ¯ï¼Œæˆ–è€…æ˜¯<code>Socket.IO</code>ã€‚</p><p>æˆ‘ä»¬äº§å“ä¸­ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯<code>Socket.IO</code>ï¼Œä½†æ˜¯ä»£ç ä¸Šç»è¿‡è¿™ä¹ˆå¤šå¹´çš„å²æœˆæ´—ç¤¼ï¼Œä»¥åŠå†ä»»ç ”å‘çš„é‡æ„è¿­ä»£ï¼Œå¤šå¤šå°‘å°‘ä¼šæœ‰äº›ä¸é‚£ä¹ˆå®Œå–„çš„åœ°æ–¹ã€‚æ‰€ä»¥å€Ÿé‰´ç€å‰è¾ˆä»¬çš„ä»£ç ï¼Œè¿›è¡Œä¸€äº›ç®€å•çš„æ¢³ç†å’Œå°è£…ï¼Œè®©ä»£ç é€»è¾‘èƒ½å¤Ÿå˜å¾—æ›´åŠ è§„èŒƒä»¥åŠç®€æ´ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬æ‰“ç®—ä½¿ç”¨<code>Socket.IO</code>ï¼Œå½“ç„¶ä¹Ÿæœ‰å¿…è¦äº†è§£ä¸€ä¸‹å®ƒçš„â€œæ¥é¾™å»è„‰â€ã€‚å¯¹äºä¸€äº›å†…éƒ¨çš„æ¦‚å¿µä»¥åŠæ ¸å¿ƒçš„é€»è¾‘éœ€è¦æœ‰åŸºæœ¬çš„äº†è§£ä»¥åŠè®¤çŸ¥ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­è¯´ä¸å®šä¼šæ˜¾å¾—æ›´åŠ æ¸¸åˆƒæœ‰ä½™ã€‚</p><h2 id="netty-socketioåŸç†æµ…æ" tabindex="-1">Netty-SocketIOåŸç†æµ…æ <a class="header-anchor" href="#netty-socketioåŸç†æµ…æ" aria-label="Permalink to &quot;Netty-SocketIOåŸç†æµ…æ&quot;">â€‹</a></h2><p>åœ¨è®²<strong>Netty-SocketIO</strong>çš„åŸç†ä¹‹å‰æœ‰å¿…è¦å¤§æ¦‚é˜è¿°ä¸‹<strong>Socket</strong>ï¼Œ<strong>Websocket</strong>ï¼Œ<strong>Socket.IO</strong>ä¹‹é—´çš„å…³ç³»ä»¥åŠå«ä¹‰ï¼š</p><ul><li><strong>Socket</strong>ï¼š<code>Socket</code>æ˜¯ä¼ è¾“æ§åˆ¶å±‚åè®®ï¼Œå®ƒå…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œæ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨<code>TCP</code>æˆ–<code>UDP</code>è€ŒæŠ½è±¡å‡ºæ¥çš„ä¸€å±‚ï¼Œæ˜¯ä½äºåº”ç”¨å±‚å’Œä¼ è¾“æ§åˆ¶å±‚ä¹‹é—´çš„ä¸€ç»„æ¥å£ã€‚å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨<code>TCP</code>å’Œ<code>UDP</code>åè®®ã€‚</li><li><strong>WebSocket</strong>ï¼š<code>WebSocket</code>æ˜¯åŸºäº<code>TCP</code>ä¼ è¾“å±‚åè®®å®ç°çš„ä¸€ç§æ ‡å‡†åè®®ã€‚ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒå‘ä¼ è¾“æ•°æ®ã€‚</li><li><strong>Socket.IO</strong><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼š<code>Socket.IO</code>æ˜¯ä¸€ä¸ªåº“ï¼Œæ”¯æŒæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶ã€åŒå‘å’ŒåŸºäºäº‹ä»¶çš„é€šä¿¡ã€‚å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œè§£å†³æµè§ˆå™¨ä¸å…¼å®¹é—®é¢˜ã€‚<code>Socket.IO</code>åŒ…å«<code>Websocket</code>ã€‚</li></ul><p>è€Œ<strong>Netty-SocketIO</strong>æ­£æ˜¯åŸºäº<code>Netty</code>æ¡†æ¶ï¼Œä½¿ç”¨Javaè¯­è¨€å®ç°çš„ä¸€å¥—<code>Socket.IO</code>æœåŠ¡å™¨ç«¯é€šä¿¡å·¥å…·ã€‚ä¹‹åé€šç¯‡ä»‹ç»å‡åŸºäºä»¥ä¸‹ç‰ˆæœ¬ç¯å¢ƒåŸºç¡€ï¼š</p><blockquote><h4 id="ğŸ’¡-ç¯å¢ƒåŸºç¡€" tabindex="-1"><strong>ğŸ’¡</strong> ç¯å¢ƒåŸºç¡€ <a class="header-anchor" href="#ğŸ’¡-ç¯å¢ƒåŸºç¡€" aria-label="Permalink to &quot;**ğŸ’¡** ç¯å¢ƒåŸºç¡€&quot;">â€‹</a></h4><p>JDK 1.8+</p><p>Netty-SocketIO 1.7.19</p></blockquote><h3 id="socketé€šä¿¡æ¨¡å‹" tabindex="-1">Socketé€šä¿¡æ¨¡å‹ <a class="header-anchor" href="#socketé€šä¿¡æ¨¡å‹" aria-label="Permalink to &quot;Socketé€šä¿¡æ¨¡å‹&quot;">â€‹</a></h3><p><img src="'+h+'" alt="Socketé€šä¿¡æ¨¡å‹"></p><p>Socketé€šä¿¡å®ç°æ­¥éª¤è§£æï¼š</p><ul><li><strong>Step 1</strong>ï¼šåˆ›å»º<code>ServerSocket</code>å’Œ<code>ClientSocket</code>ï¼›</li><li><strong>Step 2</strong>ï¼šæ‰“å¼€è¿æ¥åˆ°çš„<code>Socket</code>çš„è¾“å…¥/è¾“å‡ºæµï¼›</li><li><strong>Step 3</strong>ï¼šæŒ‰ç…§åè®®å¯¹<code>Socket</code>è¿›è¡Œè¯»/å†™æ“ä½œï¼›</li><li><strong>Step 4</strong>ï¼šå…³é—­è¾“å…¥è¾“å‡ºæµï¼Œä»¥åŠ<code>Socket</code>ï¼›</li></ul><h3 id="ä¸€äº›åŸºç¡€æ¦‚å¿µçš„ç†è§£" tabindex="-1">ä¸€äº›åŸºç¡€æ¦‚å¿µçš„ç†è§£ <a class="header-anchor" href="#ä¸€äº›åŸºç¡€æ¦‚å¿µçš„ç†è§£" aria-label="Permalink to &quot;ä¸€äº›åŸºç¡€æ¦‚å¿µçš„ç†è§£&quot;">â€‹</a></h3><h4 id="namespaceæ¨¡å‹" tabindex="-1">Namespaceæ¨¡å‹ <a class="header-anchor" href="#namespaceæ¨¡å‹" aria-label="Permalink to &quot;Namespaceæ¨¡å‹&quot;">â€‹</a></h4><p>**å‘½åç©ºé—´<sup>ğŸ”</sup>ï¼š**æ˜¯ä¸€ç§é€šä¿¡é€šé“ï¼Œå…è®¸ä½ é€šè¿‡å•ä¸ªå…±äº«è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºâ€œ<strong>å¤šè·¯å¤ç”¨</strong>â€ï¼‰æ‹†åˆ†åº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚</p><p>è¿™é‡Œé¡ºå¸¦æ‰©å±•è®²ä¸‹ï¼ŒIOå¤ç”¨æ¨¡å‹ä¸»è¦æ˜¯<code>select</code>å’Œ<code>epoll</code>ï¼Œèƒ½å¤Ÿå®ç°åŒæ—¶å¯¹å¤šä¸ªIOç«¯å£è¿›è¡Œç›‘å¬ã€‚</p><p><img src="'+k+'" alt="Namespaceæ¨¡å‹"></p><h4 id="roomsæ¨¡å‹" tabindex="-1">Roomsæ¨¡å‹ <a class="header-anchor" href="#roomsæ¨¡å‹" aria-label="Permalink to &quot;Roomsæ¨¡å‹&quot;">â€‹</a></h4><p>**æˆ¿é—´<sup>ğŸ”</sup>ï¼š**ä½¿å¾—<code>sockets</code>å¯ä»¥è¿æ¥å’Œç¦»å¼€çš„ä»»æ„é€šé“ï¼Œå®ƒå¯ç”¨äºå‘å®¢æˆ·ç«¯çš„å­é›†å¹¿æ’­äº‹ä»¶ã€‚</p><p><img src="'+l+'" alt="Roomsæ¨¡å‹"></p><h4 id="adapteræ¨¡å‹" tabindex="-1">Adapteræ¨¡å‹ <a class="header-anchor" href="#adapteræ¨¡å‹" aria-label="Permalink to &quot;Adapteræ¨¡å‹&quot;">â€‹</a></h4><p>**é€‚é…å™¨<sup>ğŸ”</sup>ï¼š**æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç»„ä»¶ï¼Œå®ƒè´Ÿè´£å‘æ‰€æœ‰æˆ–ä¸€éƒ¨åˆ†å®¢æˆ·ç«¯å¹¿æ’­äº‹ä»¶ã€‚</p><p>å½“æ‰©å±•åˆ°å¤šä¸ª<code>Socket</code>æ—¶ã€‚ åœ¨IOæœåŠ¡å™¨ä¸Šï¼Œæ‚¨å°†éœ€è¦ç”¨å¦ä¸€ä¸ªå®ç°ï¼ˆå¦‚<code>Redis</code>é€‚é…å™¨ï¼‰æ›¿æ¢é»˜è®¤çš„å†…å­˜é€‚é…å™¨ï¼Œä»¥ä¾¿å°†äº‹ä»¶æ­£ç¡®è·¯ç”±åˆ°æ‰€æœ‰å®¢æˆ·æœºã€‚</p><p>å·²æœ‰çš„Adapterå¦‚ä¸‹ï¼š</p><ul><li><a href="https://socket.io/docs/v4/redis-adapter/" target="_blank" rel="noreferrer">Redis adapter</a></li><li><a href="https://socket.io/docs/v4/mongo-adapter/" target="_blank" rel="noreferrer">MongoDB adapter</a></li><li><a href="https://socket.io/docs/v4/postgres-adapter/" target="_blank" rel="noreferrer">Postgres adapter</a></li><li><a href="https://socket.io/docs/v4/cluster-adapter/" target="_blank" rel="noreferrer">Cluster adapter</a></li></ul><p><img src="'+t+'" alt="é›†ç¾¤æ¨¡å‹"></p><h3 id="netty-socketioæ¡†æ¶ç»“æ„" tabindex="-1">Netty-SocketIOæ¡†æ¶ç»“æ„ <a class="header-anchor" href="#netty-socketioæ¡†æ¶ç»“æ„" aria-label="Permalink to &quot;Netty-SocketIOæ¡†æ¶ç»“æ„&quot;">â€‹</a></h3><p><img src="'+p+'" alt="Netty-SocketIOæ¶æ„ç»“æ„å›¾"></p><p>å„ä¸ªæ¨¡å—æ‰€è´Ÿè´£çš„çš„åŠŸå¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li><strong>SocketIOServer</strong>ï¼šsocketæœåŠ¡ç«¯å¯¹è±¡ç±»ï¼Œå®ç°<code>ClientListeners</code>æ¥å£ï¼Œæˆå‘˜å±æ€§åŒ…æ‹¬<code>Configuration</code>ï¼Œ<code>SocketIONamespace</code>ï¼Œ<code>NamespacesHub</code>ï¼Œ<code>SocketIOChannelInitializer</code>ç­‰ï¼Œè¿˜åŒ…æ‹¬æœåŠ¡çš„å¯åœåŠŸèƒ½ï¼›</li><li><strong>Listener</strong>ï¼šç›‘å¬å™¨ç±»ï¼Œä¸»è¦ç”¨äºç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥äº‹ä»¶ï¼ŒPingäº‹ä»¶ï¼Œå¼‚å¸¸äº‹ä»¶ä»¥åŠå‘é€æ¶ˆæ¯çš„äº‹ä»¶ï¼›</li><li><strong>Handler</strong>ï¼šå¤„ç†å™¨ç±»ï¼Œè´Ÿè´£è¯·æ±‚çš„æƒé‰´ï¼ŒURLæ ¡éªŒï¼Œæ¶ˆæ¯æŠ¥æ–‡ç¼–ç ç­‰ï¼›</li><li><strong>Configuration</strong>ï¼šåŸºç¡€é…ç½®ç±»ï¼ŒåŒ…æ‹¬<code>hostname</code>ï¼Œ<code>port</code>ï¼Œ<code>context</code>ï¼Œæ¶ˆæ¯è¶…æ—¶ï¼Œä¼ è¾“åè®®ç­‰ã€‚</li></ul><h3 id="æ ¸å¿ƒç±»å’Œæ–¹æ³•" tabindex="-1">æ ¸å¿ƒç±»å’Œæ–¹æ³• <a class="header-anchor" href="#æ ¸å¿ƒç±»å’Œæ–¹æ³•" aria-label="Permalink to &quot;æ ¸å¿ƒç±»å’Œæ–¹æ³•&quot;">â€‹</a></h3><h4 id="socketioclient" tabindex="-1">SocketIOClient <a class="header-anchor" href="#socketioclient" aria-label="Permalink to &quot;SocketIOClient&quot;">â€‹</a></h4><p>å®¢æˆ·ç«¯æ¥å£ï¼Œå…¶å®ç°ç±»æ˜¯NamespaceClientï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹</p><blockquote><p>joinRoom() åŠ å…¥åˆ°æŒ‡å®šæˆ¿é—´ã€‚</p><p>leaveRoom() ä»æŒ‡å®šæˆ¿é—´ç¦»å¼€ã€‚</p><p>getSessionId()æ–¹æ³•ï¼Œè¿”å›ç”±UUIDç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ã€‚</p><p>getAllRooms() è¿”å›å½“å‰å®¢æˆ·ç«¯æ‰€åœ¨çš„roomåç§°åˆ—è¡¨ã€‚</p><p>sendEvent(eventName,data) å‘å½“å‰å®¢æˆ·ç«¯å‘é€äº‹ä»¶ã€‚</p></blockquote><h4 id="socketioserver" tabindex="-1">SocketIOServer <a class="header-anchor" href="#socketioserver" aria-label="Permalink to &quot;SocketIOServer&quot;">â€‹</a></h4><p>æœåŠ¡ç«¯å®ä¾‹ï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>getAllClients() è¿”å›é»˜è®¤åç§°ç©ºé—´ä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯å®ä¾‹ã€‚</p><p>getBroadcastOperations() è¿”å›é»˜è®¤åç§°ç©ºé—´çš„æ‰€æœ‰å®ä¾‹ç»„æˆçš„å¹¿æ’­å¯¹è±¡ã€‚</p><p>getRoomOperations() è¿”å›æ‰€æœ‰å‘½åç©ºé—´ä¸­æŒ‡å®šæˆ¿é—´çš„å¹¿æ’­å¯¹è±¡ï¼Œå¦‚æœå‘½åç©ºé—´åªæœ‰ä¸€ä¸ªï¼Œè¯¥æ–¹æ³•åˆ°å¯ä»¥å¤§èƒ†ä½¿ç”¨ã€‚</p><p>getClient(uid) è¿”å›é»˜è®¤åç§°ç©ºé—´çš„æŒ‡å®šå®¢æˆ·ç«¯ã€‚</p><p>getNamespace() è¿”å›æŒ‡å®šåç§°çš„å‘½åç©ºé—´ã€‚</p></blockquote><h4 id="annotation" tabindex="-1">Annotation <a class="header-anchor" href="#annotation" aria-label="Permalink to &quot;Annotation&quot;">â€‹</a></h4><blockquote><p>@OnConnect è¿æ¥å¤„ç†æ³¨è§£</p><p>@OnDisconnect æ–­å¼€è¿æ¥å¤„ç†æ³¨è§£</p><p>@OnEvent æ¶ˆæ¯æ—¶é—´å¤„ç†æ³¨è§£</p></blockquote><h4 id="namespace" tabindex="-1">Namespace <a class="header-anchor" href="#namespace" aria-label="Permalink to &quot;Namespace&quot;">â€‹</a></h4><p>ä»NamespacesHubçš„getRoomClientsæ–¹æ³•å¯ä»¥çŸ¥é“ï¼ŒSocketIOServerçš„getRoomOperationsæ–¹æ³•è¿”å›çš„æ˜¯æ‰€æœ‰namespaceä¸­æŒ‡å®šroomä¸­çš„å®¢æˆ·ç«¯å®ä¾‹ã€‚è€Œä¸æ˜¯æŒ‡å®šå‘½åç©ºé—´æˆ–è€…é»˜è®¤å‘½åç©ºé—´çš„ï¼Œä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™è¦å°å¿ƒã€‚</p><p>å¦‚æœè¦è·å–æŒ‡å®šå‘½åç©ºé—´çš„æŒ‡å®šroomä¸­çš„å®¢æˆ·ç«¯ï¼Œä¸€å®šè¦å…ˆæ‹¿åˆ°æŒ‡å®šnamespaceå¯¹è±¡ã€‚</p><p>Namespace<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>ä¸­çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>getAllClients() è·å¾—æœ¬namespaceä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯ã€‚</p><p>getClient() è·å¾—æŒ‡å®šidå®¢æˆ·ç«¯å¯¹è±¡ã€‚</p><p>getRoomClients(room) è·å¾—æœ¬ç©ºé—´ä¸­æŒ‡å®šæˆ¿é—´ä¸­çš„å®¢æˆ·ç«¯ã€‚</p><p>getRooms() è·å¾—æœ¬ç©ºé—´ä¸­çš„æ‰€æœ‰æˆ¿é—´ã€‚</p><p>getRooms(client) è·å¾—æŒ‡å®šå®¢æˆ·ç«¯æ‰€åœ¨çš„æˆ¿é—´åˆ—è¡¨ã€‚</p><p>leave(room,uuid) å°†æŒ‡å®šå®¢æˆ·ç«¯ç¦»å¼€æŒ‡å®šæˆ¿é—´ï¼Œå¦‚æœæˆ¿é—´ä¸­å·²æ— å®¢æˆ·ç«¯ï¼Œåˆ é™¤è¯¥æˆ¿é—´ã€‚</p><p>getBroadcastOperations() è¿”å›é’ˆå¯¹ç©ºé—´ä¸­æ‰€æœ‰å®¢æˆ·ç«¯çš„å¹¿æ’­å¯¹è±¡ã€‚</p><p>getRoomOperations(room) è¿”å›é’ˆå¯¹æŒ‡å®šæˆ¿é—´çš„å¹¿æ’­å¯¹è±¡ã€‚</p></blockquote><h4 id="broadcastoperations" tabindex="-1">BroadcastOperations <a class="header-anchor" href="#broadcastoperations" aria-label="Permalink to &quot;BroadcastOperations&quot;">â€‹</a></h4><p>å¹¿æ’­æ“ä½œå¯¹è±¡ï¼Œé€šè¿‡å¯¹Namespaceçš„äº†è§£æˆ‘ä»¬çŸ¥é“ï¼ŒBroadcastOperationséƒ½æ˜¯å‘½åç©ºé—´ä»¥æŒ‡å®šroomä¸­çš„clientsåˆ—è¡¨ä¸ºå‚æ•°åˆ›å»ºçš„ã€‚</p><p>BroadcastOperationsä¸­æœ€é€šç”¨çš„æ–¹æ³•ä¾¿æ˜¯sendEventæ–¹æ³•ï¼Œè¯¥æ–¹æ³•éå†clientsï¼Œé€šè¿‡æ‰§è¡Œå®¢æˆ·ç«¯çš„sendæ–¹æ³•å®ç°å¹¿æ’­ç›®çš„ã€‚ä¹Ÿå¯ä»¥è®¾å®šä¸€ä¸ªæ’é™¤å¯¹è±¡ï¼Œå½“ç„¶ç”¨äºæ’é™¤å‘é€è€…è‡ªå·±äº†ã€‚</p><blockquote><p>sendEvent(eventname,data) å‘æœ¬å¹¿æ’­å¯¹è±¡ä¸­çš„å…¨ä½“å®¢æˆ·ç«¯å‘é€å¹¿æ’­ã€‚</p><p>sendEvent(eventname,excludeSocketIOClient,data) æ’é™¤æŒ‡å®šå®¢æˆ·ç«¯å¹¿æ’­ã€‚</p></blockquote><h2 id="é¡¹ç›®ç°çŠ¶åˆ†æ" tabindex="-1">é¡¹ç›®ç°çŠ¶åˆ†æ <a class="header-anchor" href="#é¡¹ç›®ç°çŠ¶åˆ†æ" aria-label="Permalink to &quot;é¡¹ç›®ç°çŠ¶åˆ†æ&quot;">â€‹</a></h2><h3 id="ä»£ç ç°çŠ¶" tabindex="-1">ä»£ç ç°çŠ¶ <a class="header-anchor" href="#ä»£ç ç°çŠ¶" aria-label="Permalink to &quot;ä»£ç ç°çŠ¶&quot;">â€‹</a></h3><p>ç›®å‰é¡¹ç›®ä¸­å·²æœ‰çš„ä½¿ç”¨æ–¹å¼å› ä¸ºå†å²é—ç•™é—®é¢˜ï¼Œå¤–åŠ â€œå¹´ä¹…å¤±ä¿®â€ï¼Œç•¥æ˜¾ç²—ç³™ã€‚æ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªäººâ„¢å¼€äº†é‚£ä¸ªåå¤´ï¼Œé”™è¯¯ä»æ­¤å°±ä¼šè¢«ä¸€ç›´ä¼ æ‰¿å’Œå»¶ç»­ï¼ˆ<em>â” ä¸çŸ¥é“ä½ ä»¬çš„é¡¹ç›®ä¸­æ˜¯å¦ä¹Ÿæœ‰è¿™ç±»é—®é¢˜ä»¥åŠå›°æƒ‘ â”</em>ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥è´´ç‚¹åé¢äº‹ä¾‹ï¼Œåˆ‡å‹¿æ¨¡ä»¿ï¼š</p><p>1ã€ä»£ç é‡å¤ç‡é«˜ï¼Œå¤§å¤šæ˜¯å¤åˆ¶ç²˜è´´çš„æ–¹å¼å†—ä½™ç€å¤§é‡çš„socketè¿æ¥ã€æ–­å¼€ï¼Œsessionç»´æŠ¤çš„é€»è¾‘ï¼›</p><p><img src="'+e+'" alt="image-20220110100419100"></p><p><img src="'+E+'" alt="image-20220110100458492"></p><p><img src="'+r+'" alt="image-20220110100547318"></p><p>2ã€åˆ›å»ºçš„<strong>SocketIOServer</strong>æœåŠ¡æ— æ³•éšç€ä¸»è¿›ç¨‹çš„åœæ­¢è€Œåœæ­¢ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ç»„ä»¶é‡å¯ä¼šæç¤ºç«¯å£è¢«å ç”¨é”™è¯¯ï¼Œéœ€è¦é‡å¯å¤šæ¬¡æ‰èƒ½å¯åŠ¨ç»„ä»¶ï¼›</p><p><img src="'+d+'" alt="image-20220110140642844"></p><p>3ã€æœåŠ¡çš„æ³¨å…¥æ–¹å¼çœŸçš„å¾ˆéš¾ç§°ä¹‹ä¸ºä¼˜ç¾ï¼Œå„ç§ifåˆ¤æ–­é€»è¾‘ï¼Œç”šè‡³çœ‹ç€æœ‰ç‚¹æ“è›‹ã€‚</p><p><img src="'+g+'" alt="image-20220110095728724"></p><p>4ã€æ²¡æœ‰é›†æˆé‰´æƒï¼Œç›´æ¥é€šè¿‡è¯·æ±‚æ˜æ–‡ä¼ é€’<code>userId</code>çš„æ–¹å¼è¿æ¥å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œä¸”åœ¨çº¿ç”¨æˆ·çš„<code>session</code>é©»ç•™åœ¨å„ä¸ªç›‘å¬ç±»ä¸­ï¼Œä¸æ–¹ä¾¿ç»Ÿè®¡åˆ†æå„ä¸ªäº‹ä»¶ä¸»é¢˜ä¸‹çš„åœ¨çº¿ç”¨æˆ·ä»¥åŠåœç•™æ—¶é—´ï¼›</p><p><img src="'+y+'" alt="image-20221011095129953"></p><p>5ã€æ—¥å¿—æ‰“å°ä¸è§„èŒƒï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è®¢é˜…ã€æ•°æ®æ¨é€ã€ç¦»çº¿æ—¥å¼æ‰“å°èŒƒå¼ï¼Œé¡¹ç›®éƒ¨ç½²ä¹‹åä¸æ–¹ä¾¿é—®é¢˜æ’æŸ¥ã€‚</p><h3 id="æ¶ˆæ¯é€šçŸ¥æ¨¡å¼" tabindex="-1">æ¶ˆæ¯é€šçŸ¥æ¨¡å¼ <a class="header-anchor" href="#æ¶ˆæ¯é€šçŸ¥æ¨¡å¼" aria-label="Permalink to &quot;æ¶ˆæ¯é€šçŸ¥æ¨¡å¼&quot;">â€‹</a></h3><p>å®¢æˆ·ç«¯å‘èµ·æ³¨å†Œè¯·æ±‚ï¼Œåç«¯å°†æ‰€æœ‰çš„å®¢æˆ·ç«¯ç¼“å­˜åœ¨ä¸€ä¸ªé›†åˆå†…ï¼Œåç«¯äº§ç”Ÿæ¶ˆæ¯çš„æ—¶å€™ï¼Œéå†ç”¨æˆ·é›†åˆï¼Œå¾ªç¯è¿›è¡Œæ¶ˆæ¯çš„åˆ†å‘ï¼Œè¿™ä¸ªâ€œä¼ ç»Ÿâ€å·²ç»å»¶ç»­äº†å¾ˆå¤šä¸ªå¹´å¤´ã€‚</p><p><img src="'+c+'" alt="image-20220624150923335"></p><h2 id="è®¾è®¡ç›®æ ‡-æ–¹æ¡ˆ" tabindex="-1">è®¾è®¡ç›®æ ‡&amp;æ–¹æ¡ˆ <a class="header-anchor" href="#è®¾è®¡ç›®æ ‡-æ–¹æ¡ˆ" aria-label="Permalink to &quot;è®¾è®¡ç›®æ ‡&amp;æ–¹æ¡ˆ&quot;">â€‹</a></h2><h3 id="è®¾è®¡ç›®æ ‡" tabindex="-1">è®¾è®¡ç›®æ ‡ <a class="header-anchor" href="#è®¾è®¡ç›®æ ‡" aria-label="Permalink to &quot;è®¾è®¡ç›®æ ‡&quot;">â€‹</a></h3><p>å› ä¸ºåœ¨wikiä¸­å¤§å¤šèƒ½å¤ŸæŸ¥åˆ°çš„æ˜¯æ€ä¹ˆé›†æˆwebsocketï¼Œç½‘ç»œèµ„æºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯ç°åœ¨è‡ªå·±æƒ³è¦å®ç°çš„æ˜¯å¦‚ä½•é›†æˆ<strong>Netty-SocketIO</strong>ï¼Œæ ¹æ®ä¸Šæ–‡ä¸­æåˆ°çš„ä¸€äº›ç°çŠ¶é—®é¢˜ï¼Œå¤§æ¦‚æƒ³åˆ°ä¼˜åŒ–çš„ç‚¹å¦‚ä¸‹ï¼ˆå…¶ä¸­ä¸»è¦è¿˜æ˜¯ä»£ç ç¼–å†™æ–¹é¢çš„ï¼Œæš‚æœªè€ƒè™‘æ€§èƒ½ç­‰é—®é¢˜ï¼‰ï¼š</p><ul><li>å°è£…å¯åŠ¨ä¾èµ–å·¥å…·ï¼Œå…é™¤ç¼–å†™serveræœåŠ¡çš„å¯åŠ¨ï¼Œæ³¨å…¥ï¼Œé”€æ¯çš„é€»è¾‘ï¼Œç»Ÿä¸€ä¾èµ–å…³ç³»ï¼›</li><li>é€šè¿‡æ³¨è§£çš„æ–¹å¼è¿›è¡Œæ¥å£çš„å°è£…æ³¨å…¥ï¼Œä»£ç æ•´æ´æ˜“è¯»ï¼›</li><li>ç»Ÿä¸€ç®¡ç†åœ¨çº¿ç”¨æˆ·ä»¥åŠè®¢é˜…é‰´æƒï¼Œå®ç°æ¶ˆæ¯çš„æƒé™æ§åˆ¶å’Œåˆ†å‘ï¼›</li><li>ç»Ÿä¸€ä¸»é¢˜çš„è®¢é˜…é€»è¾‘ï¼Œç®€åŒ–å‰åç«¯å¯¹æ¥è”è°ƒæˆæœ¬ï¼›</li></ul><h3 id="è®¾è®¡æ–¹æ¡ˆ" tabindex="-1">è®¾è®¡æ–¹æ¡ˆ <a class="header-anchor" href="#è®¾è®¡æ–¹æ¡ˆ" aria-label="Permalink to &quot;è®¾è®¡æ–¹æ¡ˆ&quot;">â€‹</a></h3><p>ç»“åˆä¸Šæ–‡ä¸­æåˆ°çš„<strong>Netty-SocketIO</strong>æ„æˆï¼Œæˆ‘ä»¬å°†ç»„ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†æå’ŒSocketä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><p><img src="'+o+'" alt=""></p><p>æˆ‘ä»¬ä»¥ä¸€ä¸ªå®æ—¶é¢„è­¦çš„åŠŸèƒ½ä¸ºä¾‹ï¼Œå¯¹é¡µé¢è¿›è¡Œæ‹†è§£ï¼šæŸæŸä¸šåŠ¡ç»„ä»¶æ®µ==ã€‹å®æ—¶é¢„è­¦æ¨¡å—==ã€‹èµ„æº+ä¸šåŠ¡æ•°æ®ï¼Œèµ„æºå’Œä¸šåŠ¡æ•°æ®æš‚ä¸åšæƒé™çš„æ§åˆ¶ï¼Œè€Œ<code>SocketIO</code>å’Œä¸šåŠ¡ç»„ä»¶çš„å¯¹åº”å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š</p><p>æŸæŸä¸šåŠ¡ç»„ä»¶æ®µï¼ˆnamespaceï¼‰==ã€‹èµ„æºé¢æ¿ï¼ˆresourceRoomï¼‰+é¢„è­¦æ•°æ®ï¼ˆwarmDataRoomï¼‰==ã€‹è®¾å¤‡çŠ¶æ€æ•°æ®ï¼ˆdeviceStateEventï¼‰+æŠ¥è­¦æ•°æ®ï¼ˆalarmEventï¼‰</p><h2 id="è®¾è®¡å®ç°" tabindex="-1">è®¾è®¡å®ç° <a class="header-anchor" href="#è®¾è®¡å®ç°" aria-label="Permalink to &quot;è®¾è®¡å®ç°&quot;">â€‹</a></h2><p>å®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¼šè¯·æ±‚è·å–<code>SocketIO</code>çš„è¿æ¥ä¿¡æ¯ï¼Œå€Ÿæ­¤åˆšå¥½ä»è¯·æ±‚çš„<code>Cookie</code>ä¸­è·å–åˆ°<code>ctgt</code>ä¿¡æ¯ï¼Œä¹‹åé€šè¿‡æ ¸å¿ƒæœåŠ¡æ ¹æ®<code>ctgt</code>ç”Ÿæˆä»¤ç‰Œ<code>ct</code>ç”¨äºä¹‹åçš„é‰´æƒåˆ¤æ–­ã€‚</p><p><img src="'+F+`" alt=""></p><h3 id="å¯åŠ¨å·¥å…·å°è£…" tabindex="-1">å¯åŠ¨å·¥å…·å°è£… <a class="header-anchor" href="#å¯åŠ¨å·¥å…·å°è£…" aria-label="Permalink to &quot;å¯åŠ¨å·¥å…·å°è£…&quot;">â€‹</a></h3><h4 id="æœåŠ¡è‡ªåŠ¨è£…é…å™¨" tabindex="-1">æœåŠ¡è‡ªåŠ¨è£…é…å™¨ <a class="header-anchor" href="#æœåŠ¡è‡ªåŠ¨è£…é…å™¨" aria-label="Permalink to &quot;æœåŠ¡è‡ªåŠ¨è£…é…å™¨&quot;">â€‹</a></h4><p>é€šè¿‡<code>Spring</code>çš„<code>@Configuration</code>è¿›è¡ŒæœåŠ¡çš„åˆå§‹åŒ–ä»¥åŠ<code>Bean</code>æ³¨å…¥ï¼Œé”€æ¯ç­‰ä¸€åˆ—æ“ä½œï¼Œå¹¶ä¸”ç”±<code>@ConditionalOnProperty</code>æ³¨è§£æ¥æ§åˆ¶é…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆã€‚</p><p><code>SocketIOServer</code>é€šè¿‡<code>SocketioServerProperties</code>é…ç½®å®Œæˆåˆå§‹åŒ–åˆ›å»ºï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè®¾ç½®äº†é‰´æƒç›‘å¬ï¼Œå¼‚å¸¸å¤„ç†ç›‘å¬ï¼Œå®¢æˆ·ç«¯æ•°æ®å­˜å‚¨å·¥å‚ï¼Œè¿æ¥å’Œæ–­å¼€ç›‘å¬ç­‰ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * SocketIOé…ç½®ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/20 9:59</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConditionalOnProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketioServerProperties.PREFIX, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">havingValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnableConfigurationProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({SocketioServerProperties.class})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketioServerAutoConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DisposableBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketioServerProperties config;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ExceptionListener </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exceptionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DefaultExceptionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StoreFactory </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clientStoreFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MemoryStoreFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Store </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MemoryStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">destroyMethod</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;stop&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">socketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JwtAuthorizationListener </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketAuthzListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         ExceptionListener </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exceptionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, StoreFactory </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">clientStoreFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         ConnectPrinterListener </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">connectPrinterListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // èº«ä»½éªŒè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAuthorizationListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketAuthzListener);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExceptionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(exceptionListener);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStoreFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clientStoreFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUseLinuxNativeEpoll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isFailIfNativeEpollLibNotPresent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Epoll.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Epoll library not available, disabling native epoll&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUseLinuxNativeEpoll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         * åº”ç”¨é€€å‡ºæ—¶ï¼Œè¦è°ƒç”¨shutdownæ¥æ¸…ç†èµ„æºï¼Œå…³é—­ç½‘ç»œè¿æ¥ï¼Œæ³¨é”€è‡ªå·±</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         * æ³¨æ„ï¼šæˆ‘ä»¬å»ºè®®åº”ç”¨åœ¨JBOSSã€Tomcatç­‰å®¹å™¨çš„é€€å‡ºé’©å­é‡Œè°ƒç”¨shutdownæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Runtime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRuntime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addShutdownHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketioServerShutdownHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(server));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.socketIOServer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPrintBanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOGOPrinter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOServer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConnectListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connectPrinterListener);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOServer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDisconnectListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connectPrinterListener);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SpringAnnotationScanner </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">springAnnotationScanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SpringAnnotationScanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketServer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer socketIOServer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (socketIOServer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            socketIOServer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="é…ç½®ä¸­å¿ƒ" tabindex="-1">é…ç½®ä¸­å¿ƒ <a class="header-anchor" href="#é…ç½®ä¸­å¿ƒ" aria-label="Permalink to &quot;é…ç½®ä¸­å¿ƒ&quot;">â€‹</a></h4><p>åŸºç¡€çš„é…ç½®ç±»ç»§æ‰¿Netty-SocketIOè‡ªå¸¦çš„<code>Configuration</code>ç±»ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ‹“å±•äº†<code>enabled</code><sup>å¯åŠ¨å¼€å…³</sup>ï¼Œ<code>printBanner</code><sup>æ‰“å°å¼€å…³</sup>ï¼Œ<code>devMode</code><sup>å¼€å‘è€…æ¨¡å¼ï¼ˆæœ¬åœ°jwtè°ƒè¯•ç”¨ï¼‰</sup>ï¼Œ<code>failIfNativeEpollLibNotPresent</code><sup>Epollå¼‚å¸¸æ£€æµ‹å¼€å…³</sup>è¿™äº›é…ç½®é¡¹ï¼Œå¢åŠ äº†SocketIOServerçš„ä½¿ç”¨çµæ´»æ€§ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * SocketioServeræœåŠ¡ç«¯é…ç½®ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/20 10:01</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConfigurationProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketioServerProperties.PREFIX)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketioServerProperties</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;spring.socketio.server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * If set to true, then useLinuxNativeEpoll property is passed to SocketIO server as is.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * If set to false and useLinuxNativeEpoll set to true,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * then additional check is performed if epoll library is available on classpath.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> failIfNativeEpollLibNotPresent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Enable Socketio Server.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> printBanner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> devMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> enabled;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">boolean</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> enabled;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isFailIfNativeEpollLibNotPresent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> failIfNativeEpollLibNotPresent;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setFailIfNativeEpollLibNotPresent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">boolean</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> failIfNativeEpollLibNotPresent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.failIfNativeEpollLibNotPresent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> failIfNativeEpollLibNotPresent;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isPrintBanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> printBanner;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setPrintBanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">boolean</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> printBanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.printBanner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> printBanner;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>application.properties</p><div class="language-properties vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">######################################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### SocketIO é…ç½®ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">######################################################</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/tisp-alarm-ws</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=localhost</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=17004</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.socket-config.reuse-address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.socket-config.so-linger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.transports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=[polling, websocket]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">spring.socketio.server.use-linux-native-epoll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false</span></span></code></pre></div><h4 id="ç»Ÿä¸€æ—¥å¿—æ‰“å°ç›‘å¬å™¨" tabindex="-1">ç»Ÿä¸€æ—¥å¿—æ‰“å°ç›‘å¬å™¨ <a class="header-anchor" href="#ç»Ÿä¸€æ—¥å¿—æ‰“å°ç›‘å¬å™¨" aria-label="Permalink to &quot;ç»Ÿä¸€æ—¥å¿—æ‰“å°ç›‘å¬å™¨&quot;">â€‹</a></h4><p>Netty-SocketIOæœ¬èº«è‡ªå¸¦æœ‰<code>ConnectListener</code>, <code>DisconnectListener</code>ä¸¤ä¸ªç›‘å¬æ¥å£ç±»ï¼Œç”¨äºç›‘å¬è¿æ¥å’Œæ–­å¼€çš„çŠ¶æ€ï¼Œæ‰€ä»¥ç›´æ¥ç»§æ‰¿äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¹¶ä¸”å®ç°å¯¹åº”çš„<code>onConnect</code>å’Œ<code>onDisconnect</code>æ¥å£ç”¨ä»¥ç»Ÿä¸€è¿›è¡Œæ—¥å¿—çš„æ‰“å°ã€‚</p><p>è€Œä¸”é»˜è®¤çš„æ—¥å¿—æ‰“å°çº§åˆ«ä¸º<code>debug</code>æ¨¡å¼ï¼Œæ‰€ä»¥<code>logback.xml</code>é»˜è®¤çš„<code>warn</code>æˆ–<code>info</code>çº§åˆ«å¹¶ä¸ä¼šè¿›è¡Œç›¸åº”çš„æ—¥å¿—æ‰“å°ï¼Œå½“éœ€è¦è¿›è¡Œé—®é¢˜æ’æŸ¥çš„æ—¶å€™ï¼Œå³å¯å°†<code>ConnectPrinterListener</code>ç±»çš„æ—¥å¿—çº§åˆ«å•ç‹¬è°ƒæ•´ä¸º<code>debug</code>è¿›è¡Œè°ƒè¯•æ’æŸ¥ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è¿æ¥æ—¥å¿—æ‰“å°ç›‘å¬</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/26 19:13</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @digression done is better than perfect.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ConnectPrinterListener</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ConnectListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DisconnectListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Connect OK,Session ID  : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UrlParams   : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHandshakeData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUrlParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CONNECT_EVENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Welcome to the Jungle!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onDisconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disconnect OK,Session ID  : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="æœåŠ¡å…³é—­è¿æ¥é’©å­" tabindex="-1">æœåŠ¡å…³é—­è¿æ¥é’©å­ <a class="header-anchor" href="#æœåŠ¡å…³é—­è¿æ¥é’©å­" aria-label="Permalink to &quot;æœåŠ¡å…³é—­è¿æ¥é’©å­&quot;">â€‹</a></h4><p>åº”ç”¨åœ¨é€€å‡ºæ—¶ï¼Œè°ƒç”¨<code>server</code>çš„<code>stop</code>æ–¹æ³•æ¥æ¸…ç†èµ„æºï¼Œå…³é—­ç½‘ç»œè¿æ¥ï¼Œæ³¨é”€è‡ªå·±ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * SocketioServeræœåŠ¡å…³é—­é’©å­</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/20 9:58</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketioServerShutdownHook</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer server;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SocketioServerShutdownHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> server;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="logoæ‰“å°æœº" tabindex="-1">Logoæ‰“å°æœº <a class="header-anchor" href="#logoæ‰“å°æœº" aria-label="Permalink to &quot;Logoæ‰“å°æœº&quot;">â€‹</a></h4><p>éƒ‘é‡å…¶äº‹çš„æŠŠæ—¥å¿—æ‰“å°ä¹Ÿå•ç‹¬åˆ—å‡ºæ¥ï¼Œä¸€æ–¹é¢æ˜¯æƒ³ç€é‡å‡¸æ˜¾ä¸‹æ—¥å¿—æ‰“å°çš„é‡è¦æ€§ï¼›å¦å¤–ä¸€ä¸ªæ–¹é¢ä¹Ÿæ˜¯ä¾¿äºæˆ‘ä»¬åœ¨é¡¹ç›®å¯åŠ¨é˜¶æ®µå³äº†è§£æœåŠ¡çš„å¯åŠ¨çŠ¶æ€ï¼Œç‰ˆæœ¬ç­‰åŸºæœ¬ä¿¡æ¯ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * logoæ‰“å°å™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/26 10:48</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LOGOPrinter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Logger LOG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoggerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LOGOPrinter.class);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * å½“å‰ç‰ˆæœ¬å·</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String VERSION_NO </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;v1.7.19&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        StringBuilder str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;=========================================================================</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;   ____         __       __    ________ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;  / __/__  ____/ /_____ / /_  /  _/ __ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot; _</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/ _ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/ __/  &#39;_/ -_) __/ _/ // /_/ /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;/___/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">___/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__/_/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__(_)___/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">____/ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Version: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VERSION_NO </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bidirectional and low-latency communication for every platform.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;=========================================================================</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="jwté‰´æƒ" tabindex="-1">JWTé‰´æƒ <a class="header-anchor" href="#jwté‰´æƒ" aria-label="Permalink to &quot;JWTé‰´æƒ&quot;">â€‹</a></h3><p>å› ä¸ºç›®å‰ç»Ÿä¸€æŠ€æœ¯ä½“ç³»æ¶æ„çš„æƒé™æ§åˆ¶é€šè¿‡JWT<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>å®ç°ï¼Œæ‰€ä»¥è€ƒè™‘åˆ°SocketIOçš„é€šä¿¡çš„é‰´æƒä¹Ÿé€šè¿‡æ­¤æŠ€æœ¯å®ç°ï¼Œå¦‚æ­¤ä¸€æ¥å³èƒ½å¤Ÿå’Œåº”ç”¨å¹³å°ä¿æŒç»Ÿä¸€ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†ä¸€å¥—è¾ƒå®‰å…¨çš„é€šä¿¡æƒé™æ§åˆ¶ã€‚è€Œå…¶ä¸­æ¶‰åŠçš„æ¥å£å’ŒæŠ€æœ¯ä»‹ç»å¯å‚è€ƒwiki <a href="https://wiki.hikvision.com.cn/pages/viewpage.action?pageId=148977420" target="_blank" rel="noreferrer">19ã€(aries)å®‰å…¨é˜²æŠ¤è®¤è¯Tokenï¼šaries-jc-jwt</a>ã€‚</p><h4 id="authorizationlisteneré‰´æƒç›‘å¬" tabindex="-1">AuthorizationListeneré‰´æƒç›‘å¬ <a class="header-anchor" href="#authorizationlisteneré‰´æƒç›‘å¬" aria-label="Permalink to &quot;AuthorizationListeneré‰´æƒç›‘å¬&quot;">â€‹</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * socket io jwté‰´æƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/23 9:10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @digression done is better than perfect.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JwtAuthorizationListener</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthorizationListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${spring.socketio.server.dev-mode:false}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> devMode;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BicService bicService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String DEFAULT_USER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String AUTHORIZATION_PARAM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ct&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * HTTP Authorization header, equal to &lt;code&gt;Authorization&lt;/code&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String AUTHORIZATION_HEADER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String authorizationHeaderName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTHORIZATION_HEADER;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String authorizationParamName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTHORIZATION_PARAM;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isAuthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HandshakeData </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String userId;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (devMode) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_USER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String ct </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> obtainToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StrUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ct)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bicService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ct);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StrUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Pair&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; mySession </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateOrGetSessionIdFromRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String sessionId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mySession.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //æ­¤å¤„sessionå’ŒuserIdåšç»‘å®š,æœªæºå¸¦cookieçš„ï¼Œæ‰‹åŠ¨è®¾ç½®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mySession.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLeft</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaderNames.COOKIE, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;io=&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sessionId, userId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">obtainToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HandshakeData </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä»headerä¸­è·å–token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuthorizationHeaderName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¦‚æœheaderä¸­ä¸å­˜åœ¨tokenï¼Œåˆ™ä»å‚æ•°ä¸­è·å–token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StrUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSingleUrlParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuthorizationParamName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuthorizationHeaderName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authorizationHeaderName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setAuthorizationHeaderName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">authorizationHeaderName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.authorizationHeaderName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authorizationHeaderName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuthorizationParamName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authorizationParamName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setAuthorizationParamName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">authorizationParamName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.authorizationParamName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authorizationParamName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * å˜¿å˜¿å˜¿~ä»{@link AuthorizeHandler}æºç å‚è€ƒï¼ˆæ‹·è´ï¼‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * This method will either generate a new random sessionId or will retrieve the value stored</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * in the &quot;io&quot; cookie.  Failures to parse will cause a logging warning to be generated and a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * random uuid to be generated instead (same as not passing a cookie in the first place).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pair&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateOrGetSessionIdFromRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;io&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (values.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pair.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(values.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IllegalArgumentException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">iaex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Malformed UUID received for session! io=&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> values.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String cookieHeader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaderNames.COOKIE)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Cookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cookies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ServerCookieDecoder.LAX.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookieHeader);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Cookie cookie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookies) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;io&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pair.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IllegalArgumentException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">iaex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Malformed UUID received for session! io=&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cookie.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pair.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="bicæœåŠ¡è°ƒç”¨é€»è¾‘" tabindex="-1">bicæœåŠ¡è°ƒç”¨é€»è¾‘ <a class="header-anchor" href="#bicæœåŠ¡è°ƒç”¨é€»è¾‘" aria-label="Permalink to &quot;bicæœåŠ¡è°ƒç”¨é€»è¾‘&quot;">â€‹</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * æ ¸å¿ƒæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/23 9:56</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @digression done is better than perfect.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BicService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AriesJcLogger LOGGER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AriesJcLoggerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BicService.class);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BicRestTemplate bicRestTemplate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¸å¿ƒæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String BIC_COMPONENT_ID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@bic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String BIC_SERVICE_ID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //è·å–JWT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String APPLY_CT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/ssoService/v2/applyCT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //æ ¡éªŒtokenä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String CHECK_CT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/ssoService/v2/checkCT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * ç”Ÿæˆä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ctgt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@throws</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthorizationException</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctgt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AuthorizationException {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CTGT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctgt);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpHeaders headers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setContentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MediaType.APPLICATION_JSON);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            BaseResult&lt;Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.bicRestTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeEx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BIC_SERVICE_ID, BIC_SERVICE_ID, APPLY_CT, HttpMethod.POST, headers, map, BaseResult.class, (Map) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ApplyCT error.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ ¡éªŒä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> authorization</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@throws</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthorizationException</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">authorization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AuthorizationException {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpHeaders headers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, authorization);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The JwtService checkCT, request param jwt is : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            BaseResult&lt;Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; userDo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.bicRestTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeEx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BIC_SERVICE_ID, BIC_SERVICE_ID, CHECK_CT, HttpMethod.GET, headers, (Object) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, BaseResult.class, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userDo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CheckCT error.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="æ¶ˆæ¯è®¢é˜…å‘é€å®ç°" tabindex="-1">æ¶ˆæ¯è®¢é˜…å‘é€å®ç° <a class="header-anchor" href="#æ¶ˆæ¯è®¢é˜…å‘é€å®ç°" aria-label="Permalink to &quot;æ¶ˆæ¯è®¢é˜…å‘é€å®ç°&quot;">â€‹</a></h3><h4 id="é€šç”¨æŠ½è±¡ç±»å°è£…" tabindex="-1">é€šç”¨æŠ½è±¡ç±»å°è£… <a class="header-anchor" href="#é€šç”¨æŠ½è±¡ç±»å°è£…" aria-label="Permalink to &quot;é€šç”¨æŠ½è±¡ç±»å°è£…&quot;">â€‹</a></h4><p>å°è£…ç»Ÿä¸€çš„<code>AbstractSocketEventHandler</code>æä¾›é€šç”¨ä»¥åŠåŸºç¡€çš„èƒ½åŠ›ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li>ç»Ÿä¸€çš„è®¢é˜…å‡½æ•°<code>subscribe(SocketIOClient client, AckRequest request, R subscribeDTO)</code>ï¼›</li><li>æ–­å¼€è¿æ¥å‡½æ•°<code>onDisconnect(SocketIOClient client)</code>ï¼›</li><li>æ¶ˆæ¯å¤„ç†å‡½æ•°<code>handler(E eventObject)</code>ï¼›</li><li>è®¢é˜…æˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°<code>subscribeCallback(SocketIOClient client)</code>ï¼›</li><li>æ¶ˆæ¯å‘é€å‡½æ•°<code>sendEventByUserId(String userId, E eventObject)</code>ç­‰ç­‰ã€‚</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * socketäº‹ä»¶å¤„ç†æŠ½è±¡ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/22 15:13</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> abstract</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractSocketEventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">R</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SubscribeDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Logger LOG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoggerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AbstractSocketEventHandler.class);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer socketIOServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Store sessionStore;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractSocketEventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Store </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">store</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.socketIOServer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> socketIOServer;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sessionStore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractSocketEventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOServer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MemoryStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–EventName</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> abstract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ¶ˆæ¯å®šå‘å¤„ç† &lt;br/&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ•°æ®å‘é€äº‹ä¾‹ï¼ˆå½“å‰ä¸»é¢˜ï¼‰ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;pre&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *     å‘é€æ‰€æœ‰è®¢é˜…ç”¨æˆ·ï¼Œå‚è€ƒ{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@link</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sendEventToRoomClients(E)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *     å‘é€æŒ‡å®šç”¨æˆ·ï¼ˆuserIdï¼‰ï¼Œå‚è€ƒ{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@link</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sendEventByUserId(String, E)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *     å‘é€æŒ‡å®šç”¨æˆ·ï¼ˆsessionIdï¼‰ï¼Œå‚è€ƒ{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@link</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sendEventByClient(SocketIOClient, E)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;/pre&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> abstract</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è®¢é˜…æˆåŠŸå›è°ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribeCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * é€šç”¨è®¢é˜…æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> request</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> subscribeDTO</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OnEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SUBSCRIBE_EVENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, AckRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, R </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subscribeDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscribe </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscribeDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSubscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String eventName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscribeDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventName)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (subscribe) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            buildSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">joinRoom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventName);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            subscribeCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Subscribe OK,Event name : {},Session id : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, eventName, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            removeSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">leaveRoom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unsubscribe OK,Event name  : {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, eventName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OnDisconnect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onDisconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        removeAllSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ„é€ åœ¨çº¿ç”¨æˆ·Store</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> buildSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StrUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User id is null!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; socketIOClientSet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClientSet)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sessionStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId, CollUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newHashSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOClientSet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ„é€ åœ¨çº¿ç”¨æˆ·Store</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> removeSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; socketIOClientSet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClientSet)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOClientSet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ„é€ åœ¨çº¿ç”¨æˆ·Store</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> removeAllSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; socketIOClientSet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClientSet)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOClientSet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–ä¸´æ—¶å­˜å‚¨å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StrUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–ç”¨æˆ·ID</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HandshakeData handshakeData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHandshakeData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> handshakeData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHttpHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–sessionIdå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optional.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofNullable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getSessionId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(UUID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">toString).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orElse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SocketIOServer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSocketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> socketIOServer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setSocketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.socketIOServer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> socketIOServer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * å•ç‹¬å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> userId</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventByUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; socketIOClientSet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sendEventToClients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClientSet, eventObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * å•ç‹¬å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sessionId</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventBySessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(UUID </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sessionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SocketIOClient socketIOClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> socketIOServer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sessionId);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sendEventByClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClient, eventObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * å•ç‹¬å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> socketIOClient</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventByClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (socketIOClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Send event error,socketIOClient is null.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), eventObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ‰¹é‡å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> roomName</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventByRoom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">roomName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ObjectUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOServer)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SocketIOServer not started.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BroadcastOperations roomOperations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> socketIOServer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRoomOperations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(roomName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (roomOperations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Send event error,roomOperations is null.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        roomOperations.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), eventObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ‰€æœ‰sessionå‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventToRoomClients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sendEventByRoom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), eventObject);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * æ‰¹é‡å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> eventObject</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendEventToClients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collection&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SocketIOClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOClients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (socketIOClients </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Send event error,socketIOClients is null.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        socketIOClients.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            sendEventByClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOClient, eventObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="æ¶ˆæ¯æ¨é€å®ç°" tabindex="-1">æ¶ˆæ¯æ¨é€å®ç° <a class="header-anchor" href="#æ¶ˆæ¯æ¨é€å®ç°" aria-label="Permalink to &quot;æ¶ˆæ¯æ¨é€å®ç°&quot;">â€‹</a></h4><p>å®é™…ä¸šåŠ¡ç±»é€šè¿‡ç»§æ‰¿<code>AbstractSocketEventHandler&lt;R extends SubscribeDTO, E&gt;</code>å³è§„èŒƒäº†ç›¸åº”çš„æ¨é€å¤„ç†é€»è¾‘ï¼ŒåŒæ—¶è·å¾—äº†ç»Ÿä¸€çš„æ¶ˆæ¯è®¢é˜…ä»¥åŠæ¨é€èƒ½åŠ›ã€‚</p><p>è€Œå…¶ä¸­è®¢é˜…æˆåŠŸä¹‹åå³ä¼šé»˜è®¤è‡ªåŠ¨åŠ å…¥åˆ°å½“å‰ä¸»é¢˜äº‹ä»¶çš„<code>Room</code>ä¸­ï¼Œä¹‹åç»Ÿä¸€é€šè¿‡<code>sendEventToRoomClients</code>å‡½æ•°è¿›è¡Œæ¶ˆæ¯çš„å‘é€ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è®¾å¤‡å‘Šè­¦äº‹ä»¶å¤„ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> yuanzp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @date 2022/9/26 19:30</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DeviceAlarmEventsHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractSocketEventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SubscribeDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DeviceAlarmMessageDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Resource</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NmsService nmsService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DeviceAlarmEventsHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">required</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) SocketIOServer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socketIOServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socketIOServer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DEVICE_ALARM_EVENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DeviceAlarmMessageDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deviceAlarmMessageDTOList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sendEventToRoomClients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deviceAlarmMessageDTOList);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribeCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketIOClient </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DeviceAlarmMessageDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; deviceAlarmMessageDTOList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nmsService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryOffLineDevice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deviceAlarmMessageDTOList)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sendEventByClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client, deviceAlarmMessageDTOList);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="å‰ç«¯è®¢é˜…-æ¶ˆè´¹é€»è¾‘" tabindex="-1">å‰ç«¯è®¢é˜…&amp;æ¶ˆè´¹é€»è¾‘ <a class="header-anchor" href="#å‰ç«¯è®¢é˜…-æ¶ˆè´¹é€»è¾‘" aria-label="Permalink to &quot;å‰ç«¯è®¢é˜…&amp;æ¶ˆè´¹é€»è¾‘&quot;">â€‹</a></h4><p>å› ä¸ºå°†äº‹ä»¶çš„è®¢é˜…æŠ½æˆäº†ç»Ÿä¸€çš„é€»è¾‘ï¼Œæ‰€ä»¥å‰ç«¯ä¹Ÿç»Ÿä¸€å°è£…äº†<code>subscribeData</code>å‡½æ•°ï¼Œç”¨ä»¥å¤„ç†å’Œåç«¯åˆå§‹åŒ–è®¢é˜…ã€‚ä¹‹åé€šè¿‡<code>listenSubscribeData</code>ç›‘å¬å¤„ç†å‡½æ•°ç”¨ä»¥è§£ææ¨é€çš„æŠ¥æ–‡ã€‚</p><p>ï¼ˆæ³¨ï¼šä»é¡¹ç›®ä¸­æ‘˜äº†ä¸€æ®µå‰ç«¯äº‹ä¾‹ï¼Œæ‰€ä»¥ä»£ç å¯èƒ½ä¸å°½å®Œå–„ï¼Œæœ›å‰ç«¯å…„å¼Ÿè°…è§£ã€‚ï¼‰</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¢é˜…è®¾å¤‡å¼‚å¸¸å‘Šè­¦æ¶ˆæ¯å¹¶è·å–è®¾å¤‡å¼‚å¸¸å‘Šè­¦æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDeviceAlarmList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  subscribeData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketSubscribeType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SUBSCRIBE_EVENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	eventName: SocketSubscribeType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEVICE_ALARM_EVENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  listenSubscribeData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SocketSubscribeType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEVICE_ALARM_EVENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°è®¾å¤‡å¼‚å¸¸å‘Šè­¦æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> offlineDevice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.deviceEventType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DeviceStatus.offline)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> deviceIds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.deviceEventId)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.equipAlarmList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.equipAlarmList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deviceIds.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res.deviceEventId)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  offlineDevice.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.equipAlarmList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unshift</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	  deviceType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;speedDomeCameras&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	  isUnread: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="å¯åŠ¨-è°ƒè¯•" tabindex="-1">å¯åŠ¨&amp;è°ƒè¯• <a class="header-anchor" href="#å¯åŠ¨-è°ƒè¯•" aria-label="Permalink to &quot;å¯åŠ¨&amp;è°ƒè¯•&quot;">â€‹</a></h3><p>é¡¹ç›®å¯åŠ¨åæ‰“å°å¦‚ä¸‹æ—¥å¿—å³è¡¨ç¤º<code>SocketIOServer</code>å¯åŠ¨æˆåŠŸã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2022</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">31T14</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">04</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">19.979</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  INFO tisp.tisp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">alarm [main] [com.hikvision.jt.tisp.alarm.config.socketio.LOGOPrinter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">================================================================================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   ____         __       __    ________ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__  ____</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_____ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  _</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __ \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _\\ \\</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ \\</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> __</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;_/ -_) __/ _/ // /_/ /</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/___/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_/_/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\_\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_(_)___/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">___/ </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Version: v1.7.19</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Bidirectional and low-latency communication for every platform.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">================================================================================================</span></span></code></pre></div><p>é¡µé¢è¿æ¥ï¼Œè®¢é˜…ï¼Œæ–­å¼€è¿æ¥åˆ†åˆ«ä¼šæ‰“å°å¦‚ä¸‹æ—¥å¿—ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2022</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">31T14</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30.977</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEBUG tisp.tisp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">alarm [nioEventLoopGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [com.hikvision.jt.tisp.alarm.config.socketio.handler.ConnectPrinterListener</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">21</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Connect OK,Session ID  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 785f9a7d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">15f7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4223</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9789</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">20b1404fed1e </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2022</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">31T14</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31.192</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEBUG tisp.tisp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">alarm [nioEventLoopGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [com.hikvision.jt.tisp.alarm.modules.socketio.AbstractSocketEventHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">83</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Subscribe OK,Event name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEVICE_ALARM_EVENT,Session id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 785f9a7d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">15f7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4223</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9789</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">20b1404fed1e </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2022</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">31T14</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">29.480</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEBUG tisp.tisp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">alarm [nioEventLoopGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [com.hikvision.jt.tisp.alarm.config.socketio.handler.ConnectPrinterListener</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Disconnect OK,Session ID  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 785f9a7d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">15f7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4223</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9789</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">20b1404fed1e</span></span></code></pre></div><p>å‰ç«¯è¿›è¡ŒF12è°ƒè¯•ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”ä¸»é¢˜çš„è®¢é˜…ä»¥åŠæ¶ˆæ¯ä¸‹å‘çš„æŠ¥æ–‡ï¼š</p><p><img src="`+A+'" alt=""></p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1">å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;å‚è€ƒèµ„æ–™&quot;">â€‹</a></h2><ul><li>ã€mrniko / netty-socketioã€‘ï¼š<a href="https://github.com/mrniko/netty-socketio" target="_blank" rel="noreferrer">https://github.com/mrniko/netty-socketio</a></li><li>ã€hiwepy / socketio-spring-boot-starterã€‘ï¼š<a href="https://gitee.com/hiwepy/socketio-spring-boot-starter" target="_blank" rel="noreferrer">https://gitee.com/hiwepy/socketio-spring-boot-starter</a></li><li>ã€socketï¼Œwebsocketï¼Œsocketioä¹‹é—´çš„å…³ç³»ã€‘ï¼š<a href="https://www.cnblogs.com/laochiji/p/12887063.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/laochiji/p/12887063.html</a></li><li>ã€Netty-SocketIOï¼šæœ€å¥½ç”¨çš„Javaç‰ˆå³æ—¶æ¶ˆæ¯æ¨é€ã€‘ï¼š<a href="https://blog.csdn.net/qing_gee/article/details/52525677" target="_blank" rel="noreferrer">https://blog.csdn.net/qing_gee/article/details/52525677</a></li></ul><h2 id="å†™åœ¨æœ€åé¢çš„è¯" tabindex="-1">å†™åœ¨æœ€åé¢çš„è¯ <a class="header-anchor" href="#å†™åœ¨æœ€åé¢çš„è¯" aria-label="Permalink to &quot;å†™åœ¨æœ€åé¢çš„è¯&quot;">â€‹</a></h2><p>è¿™æ¬¡å€Ÿç€â€œé‚£çœ‰å²­éš§é“é¡¹ç›®â€çš„æœºä¼šé‡æ–°æ¢³ç†å¼€å‘äº†æ¶ˆæ¯æ¨é€çš„é€»è¾‘ã€‚ä½†æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®çš„å¼€å‘å‘¨æœŸæå…¶ç´§å¼ ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¹‹åˆæˆ‘çº ç»“çŠ¹è±«äº†å¾ˆä¹…å¾ˆä¹…ï¼šåˆ°åº•æ˜¯ä»åˆ«çš„è€é¡¹ç›®ä¸Šç›´æ¥æ‹·è´ä¸€ä»½ç°æœ‰é€»è¾‘è¿‡æ¥æ‹¾æ‡æ‹¾æ‡ï¼›è¿˜æ˜¯ä»é›¶å¼€å§‹é‡æ–°æ¢³ç†ç¼–ç ã€‚</p><p>æƒ³åˆ°ä¸€å¹´å‰å°±æœ‰è¿™ä¸ªæƒ³æ³•åšè¿™ä»¶äº‹ï¼Œå¹¶ä¸ºæ­¤æŠ½ç©ºçœ‹äº†ä¸€äº›èµ„æ–™åšå‡†å¤‡ï¼Œè¿™æ¬¡åˆšå¥½åˆæ˜¯ä¸€ä¸ªå…¨æ–°å¼€å‘çš„ç»„ä»¶ï¼ŒçœŸçš„&quot;æœºä¼šéš¾å¾—&quot;ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¸‹å®šå†³å®šå»æ¢ç´¢é‡å†™è¿™å—é€»è¾‘ã€‚å½“ç„¶è¿™æœŸé—´é‡åˆ°äº†Nå¤šçš„é—®é¢˜ï¼Œè€Œæˆ‘å®ç°çš„ä¹Ÿä¸é‚£ä¹ˆå®Œå–„ï¼Œä½†è¾ƒä»¥å‰çš„ä»£ç åº”è¯¥å¤šå°‘æœ‰äº†ä¸€äº›è¿›æ­¥ï¼Œæœ€åä¹ŸæŒ‰æ—¶å®Œæˆäº†å·¥ä½œï¼Œå€æ„Ÿæ¬£æ…°ã€‚</p><p>æœ€åçš„æœ€åï¼Œç¥ä½ å¥½è¿å§ï¼Œç›†å‹~<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><p>[^Spring Boot Start]:Starter æ˜¯ Spring Boot ä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œç›¸å½“äºæ¨¡å—ï¼Œå®ƒèƒ½å°†æ¨¡å—æ‰€éœ€çš„ä¾èµ–æ•´åˆèµ·æ¥å¹¶å¯¹æ¨¡å—å†…çš„Beanæ ¹æ®ç¯å¢ƒï¼ˆæ¡ä»¶ï¼‰è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ä½¿ç”¨è€…åªéœ€è¦ä¾èµ–ç›¸åº”åŠŸèƒ½çš„ Starterï¼Œæ— éœ€åšè¿‡å¤šçš„é…ç½®å’Œä¾èµ–ï¼ŒSpringBoot å°±èƒ½è‡ªåŠ¨æ‰«æå¹¶åŠ è½½ç›¸åº”çš„æ¨¡å—ã€‚</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Socket.IOå®˜ç½‘åŸæ–‡è§£é‡Šï¼šSocket.IO is a library that enables real-time, bidirectional and event-based communication between the browser and the server. <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li><li id="fn2" class="footnote-item"><p>Namespaceï¼Œç¿»è¯‘ä¸ºâ€œå‘½åç©ºé—´â€ï¼Œnetty-socketioå¿ å®çš„é‡ç°äº†socketioçš„serverâ€“&gt;namespaceâ€“&gt;roomä¸‰å±‚åµŒå¥—å…³ç³»ã€‚ <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p></li><li id="fn3" class="footnote-item"><p><em>JWT</em>æ˜¯JSON Web Tokençš„ç¼©å†™,æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„- -ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†((RFC 7519)ã€‚ <a href="#fnref3" class="footnote-backref">â†©ï¸</a></p></li><li id="fn4" class="footnote-item"><p>â€œğŸ˜æ¯ä¸ªäººéƒ½æ˜¯ä¸€ç›ç¯â€---created by è¢å¿—é¹ on ä¹æœˆ 27,2021ï¼›last edited by è¢å¿—é¹ on åæœˆ 31,2022ï¼ˆæ³¨ï¼šä½ æ²¡æœ‰çœ‹é”™ï¼Œç¼–å†™è¿™ç¯‡æ–‡æ¡£çš„è·¨åº¦å°±æ˜¯ä¸€å¹´å¤šï¼Œå…¶ä¸­éƒ¨åˆ†æ¦‚å¿µå’Œæ¨¡å‹å›¾å‚è€ƒäº†<a href="https://socket.io/" target="_blank" rel="noreferrer"><strong>Socket.IO</strong></a>å®˜ç½‘èµ„æ–™ï¼Œåœ¨ç”»å›¾æ–¹é¢çœŸçš„ç»™æˆ‘å¼€è¾Ÿäº†ä¸€ç•ªæ–°å¤©åœ°ã€‚ï¼‰ <a href="#fnref4" class="footnote-backref">â†©ï¸</a></p></li></ol></section>',135),u=[C];function B(v,b,S,m,O,I){return a(),i("div",null,u)}const q=s(D,[["render",B]]);export{_ as __pageData,q as default};
