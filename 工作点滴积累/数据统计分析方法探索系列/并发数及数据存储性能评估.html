<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发数及数据存储性能评估 | 👽袁小猴没有秘密花园</title>
    <meta name="description" content=" ">
    <meta name="generator" content="VitePress v1.3.1">
    <link rel="preload stylesheet" href="/yzp-blog/assets/style.CMENvdba.css" as="style">
    
    <script type="module" src="/yzp-blog/assets/app.CJvStv5l.js"></script>
    <link rel="preload" href="/yzp-blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/yzp-blog/assets/chunks/framework.CUMjAKNJ.js">
    <link rel="modulepreload" href="/yzp-blog/assets/chunks/theme.Cu-c09vQ.js">
    <link rel="modulepreload" href="/yzp-blog/assets/工作点滴积累_数据统计分析方法探索系列_并发数及数据存储性能评估.md.Eq3lisfK.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-cabb9229><!--[--><!--]--><!--[--><span tabindex="-1" data-v-95ac45a4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-95ac45a4> Skip to content </a><!--]--><!----><header class="VPNav" data-v-cabb9229 data-v-f8f27b8c><div class="VPNavBar has-sidebar top" data-v-f8f27b8c data-v-fdffbfd0><div class="wrapper" data-v-fdffbfd0><div class="container" data-v-fdffbfd0><div class="title" data-v-fdffbfd0><div class="VPNavBarTitle has-sidebar" data-v-fdffbfd0 data-v-dc1977a1><a class="title" href="/yzp-blog/" data-v-dc1977a1><!--[--><!--]--><!----><span data-v-dc1977a1>👽袁小猴没有秘密花园</span><!--[--><!--]--></a></div></div><div class="content" data-v-fdffbfd0><div class="content-body" data-v-fdffbfd0><!--[--><!--]--><div class="VPNavBarSearch search" data-v-fdffbfd0><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-fdffbfd0 data-v-03a80003><span id="main-nav-aria-label" class="visually-hidden" data-v-03a80003> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/yzp-blog/" tabindex="0" data-v-03a80003 data-v-37125b5a><!--[--><span data-v-37125b5a>主页</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/15868125643/yzp-blog/issues" target="_blank" rel="noreferrer" tabindex="0" data-v-03a80003 data-v-37125b5a><!--[--><span data-v-37125b5a>给我留言</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-fdffbfd0 data-v-4cbfdffa><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="切换到深色模式" aria-checked="false" data-v-4cbfdffa data-v-e58edb33 data-v-f56a3de7><span class="check" data-v-f56a3de7><span class="icon" data-v-f56a3de7><!--[--><span class="vpi-sun sun" data-v-e58edb33></span><span class="vpi-moon moon" data-v-e58edb33></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-fdffbfd0 data-v-57467f05 data-v-90442200><!--[--><a class="VPSocialLink no-icon" href="https://github.com/15868125643/yzp-blog" aria-label="github" target="_blank" rel="noopener" data-v-90442200 data-v-962972d8><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-fdffbfd0 data-v-e06f7b91 data-v-e0b1ae98><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-e0b1ae98><span class="vpi-more-horizontal icon" data-v-e0b1ae98></span></button><div class="menu" data-v-e0b1ae98><div class="VPMenu" data-v-e0b1ae98 data-v-120b2aec><!----><!--[--><!--[--><!----><div class="group" data-v-e06f7b91><div class="item appearance" data-v-e06f7b91><p class="label" data-v-e06f7b91>主题</p><div class="appearance-action" data-v-e06f7b91><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="切换到深色模式" aria-checked="false" data-v-e06f7b91 data-v-e58edb33 data-v-f56a3de7><span class="check" data-v-f56a3de7><span class="icon" data-v-f56a3de7><!--[--><span class="vpi-sun sun" data-v-e58edb33></span><span class="vpi-moon moon" data-v-e58edb33></span><!--]--></span></span></button></div></div></div><div class="group" data-v-e06f7b91><div class="item social-links" data-v-e06f7b91><div class="VPSocialLinks social-links-list" data-v-e06f7b91 data-v-90442200><!--[--><a class="VPSocialLink no-icon" href="https://github.com/15868125643/yzp-blog" aria-label="github" target="_blank" rel="noopener" data-v-90442200 data-v-962972d8><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-fdffbfd0 data-v-2d0f40b4><span class="container" data-v-2d0f40b4><span class="top" data-v-2d0f40b4></span><span class="middle" data-v-2d0f40b4></span><span class="bottom" data-v-2d0f40b4></span></span></button></div></div></div></div><div class="divider" data-v-fdffbfd0><div class="divider-line" data-v-fdffbfd0></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-cabb9229 data-v-638d82b8><div class="container" data-v-638d82b8><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-638d82b8><span class="vpi-align-left menu-icon" data-v-638d82b8></span><span class="menu-text" data-v-638d82b8>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-638d82b8 data-v-99382d3e><button data-v-99382d3e>回到顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-cabb9229 data-v-47d4d91e><div class="curtain" data-v-47d4d91e></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-47d4d91e><span class="visually-hidden" id="sidebar-aria-label" data-v-47d4d91e> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-1d7c7eab><section class="VPSidebarItem level-0 collapsible" data-v-1d7c7eab data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h2 class="text" data-v-668787e9>📚读书&感悟专区</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E8%AF%BB%E4%B9%A6%E5%88%86%E4%BA%AB%E4%B8%93%E5%8C%BA/%E5%89%8D%E8%A8%80.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>前言</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E8%AF%BB%E4%B9%A6%E5%88%86%E4%BA%AB%E4%B8%93%E5%8C%BA/%E5%81%9A%E4%BA%8B%E7%9A%84%E4%B8%89%E4%B8%AA%E5%B1%82%E9%9D%A2.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>（摘）做事的三个层面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E8%AF%BB%E4%B9%A6%E5%88%86%E4%BA%AB%E4%B8%93%E5%8C%BA/%E5%8F%B6%E5%BA%95%E8%97%8F%E8%8A%B1%E4%B8%80%E5%BA%A6%EF%BC%8C%E6%A2%A6%E9%87%8C%E8%B8%8F%E9%9B%AA%E5%87%A0%E5%9B%9E.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>（摘）叶底藏花一度，梦里踏雪几回</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E8%AF%BB%E4%B9%A6%E5%88%86%E4%BA%AB%E4%B8%93%E5%8C%BA/2024%E5%B9%B4%E4%B9%A6%E5%8D%95.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>2024年书单</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>你好，树洞（慎入）</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E8%AF%BB%E4%B9%A6%E5%88%86%E4%BA%AB%E4%B8%93%E5%8C%BA/%E6%A0%91%E6%B4%9E%E5%80%BE%E8%BF%B0%E5%8C%BA/%E4%B8%80%E5%B0%81%E7%B5%AE%E7%B5%AE%E5%8F%A8%E5%8F%A8%E7%9A%84%E4%BF%A1.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>一封絮絮叨叨的信</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-1d7c7eab><section class="VPSidebarItem level-0 collapsible" data-v-1d7c7eab data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h2 class="text" data-v-668787e9>🐒技术类经验分享</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-668787e9 data-v-668787e9><div class="item" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/%E5%AE%9E%E7%94%A8%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/%E5%BA%8F.html" data-v-668787e9><!--[--><h3 class="text" data-v-668787e9>技术类经验分享</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>RabbitMQ消息队列浅析</p><!----></div><!----></div><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>优雅的参数校验</p><!----></div><!----></div><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>异步和多线程处理</p><!----></div><!----></div><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>PG分表数据存取实战</p><!----></div><!----></div><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>日志打印的那些破事儿</p><!----></div><!----></div><div class="VPSidebarItem level-2" data-v-668787e9 data-v-668787e9><div class="item" role="button" data-v-668787e9><div class="indicator" data-v-668787e9></div><p class="text" data-v-668787e9>妙用EasyPoi实现Excel导入导出</p><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>RS-232串口通信实战开发系列</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E4%B9%8B%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E7%AF%87.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>技术原理篇</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E4%B9%8B%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E7%AF%87.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>技术选型篇</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/RS-232%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91%E4%B9%8B%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E7%AF%87.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>项目实战篇</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/%E5%A4%8D%E6%9D%82JSON%E8%A7%A3%E6%9E%90%E5%A4%84%E7%90%86%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BB%8F%E9%AA%8C%E6%B5%85%E8%B0%88.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>复杂JSON解析处理的若干经验浅谈</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%80%9A%E8%BF%87JNA%E8%B0%83%E7%94%A8C++%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%BF%87%E7%A8%8B.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>记一次通过JNA调用C++接口的过程</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>Feign实战系列</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/Feign%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97/%E9%80%9A%E8%BF%87Feign%E5%AF%B9%E6%8E%A5ISAPI%E5%8D%8F%E8%AE%AE%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%80%BB%E7%BB%93%E5%88%86%E4%BA%AB.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>通过Feign对接ISAPI协议接口的总结分享</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/Feign%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97/Feign%E5%AE%9E%E6%88%98%E4%B9%8B%E5%AF%B9%E6%8E%A5%E6%99%BA%E8%BF%90%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>对接智运开放平台</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/Feign%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97/Feign%E5%AE%9E%E6%88%98%E4%B9%8B%E5%AF%B9%E6%8E%A5%E4%BA%91%E6%9B%9C%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>对接云曜开放平台</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/%E5%9F%BA%E4%BA%8EMQTT%E5%AF%B9%E6%8E%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>基于MQTT对接第三方平台的开发案例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/WebSocket%E9%89%B4%E6%9D%83%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%8E%9F%E7%90%86.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>WebSocket鉴权的实现思路及原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8ENetty-SocketIO%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%8C%E5%90%91%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>一种基于Netty-SocketIO实现双向实时通信的方案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E6%8A%80%E6%9C%AF%E7%B1%BB%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/FRP%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%8A%80%E6%9C%AF%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>FRP内网穿透技术功能简介及项目实践</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1d7c7eab><section class="VPSidebarItem level-0 collapsible" data-v-1d7c7eab data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h2 class="text" data-v-668787e9>💣工作点滴积累</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>数据统计分析方法探索</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%B3%BB%E5%88%97/%E5%B9%B6%E5%8F%91%E6%95%B0%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>并发数及数据存储性能评估</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>代码重构系列</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84%E7%B3%BB%E5%88%97/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84%E4%B9%8B%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BB%8F%E9%AA%8C%E6%B5%85%E8%B0%88.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>资源缓存设计的若干经验浅谈</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84%E7%B3%BB%E5%88%97/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84%E4%B9%8BMQ%E6%B6%88%E6%81%AF%E5%AF%B9%E6%8E%A5%E5%A4%84%E7%90%86%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BB%8F%E9%AA%8C%E6%B5%85%E8%B0%88.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>MQ消息对接处理的若干经验浅谈</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-668787e9 data-v-668787e9><div class="item" role="button" tabindex="0" data-v-668787e9><div class="indicator" data-v-668787e9></div><h3 class="text" data-v-668787e9>浅谈系列</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-668787e9><span class="vpi-chevron-right caret-icon" data-v-668787e9></span></div></div><div class="items" data-v-668787e9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E6%B5%85%E8%B0%88%E7%B3%BB%E5%88%97/%E6%B5%85%E8%B0%88%E4%B8%80%E7%A7%8D%E4%BA%8B%E4%BB%B6%E8%81%9A%E7%B1%BB%E5%8E%BB%E9%87%8D%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>浅谈一种事件聚类去重的实现思路</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E6%B5%85%E8%B0%88%E7%B3%BB%E5%88%97/%E6%B5%85%E8%B0%88%E4%BB%A3%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BA%A6%E7%9A%84%E5%9B%B0%E5%B1%80.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>浅谈代码复杂度的困局</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-668787e9 data-v-668787e9><div class="item" data-v-668787e9><div class="indicator" data-v-668787e9></div><a class="VPLink link link" href="/yzp-blog/%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF/%E6%B5%85%E8%B0%88%E7%B3%BB%E5%88%97/%E6%B5%85%E8%B0%88%E9%A1%B9%E7%9B%AE%E4%B9%A0%E6%83%AF%E6%80%A7%E5%BB%B6%E6%9C%9F%E7%9A%84%E5%9B%B0%E5%B1%80.html" data-v-668787e9><!--[--><p class="text" data-v-668787e9>浅谈项目习惯性延期的困局</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-cabb9229 data-v-759f0eb2><div class="VPDoc has-sidebar has-aside" data-v-759f0eb2 data-v-50f4d550><!--[--><!--]--><div class="container" data-v-50f4d550><div class="aside" data-v-50f4d550><div class="aside-curtain" data-v-50f4d550></div><div class="aside-container" data-v-50f4d550><div class="aside-content" data-v-50f4d550><div class="VPDocAside" data-v-50f4d550 data-v-30ea6f21><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-30ea6f21 data-v-300e2242><div class="content" data-v-300e2242><div class="outline-marker" data-v-300e2242></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-300e2242>页面导航</div><ul class="VPDocOutlineItem root" data-v-300e2242 data-v-abf047df><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-30ea6f21></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-50f4d550><div class="content-container" data-v-50f4d550><!--[--><!--]--><main class="main" data-v-50f4d550><div style="position:relative;" class="vp-doc _yzp-blog_%E5%B7%A5%E4%BD%9C%E7%82%B9%E6%BB%B4%E7%A7%AF%E7%B4%AF_%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%B3%BB%E5%88%97_%E5%B9%B6%E5%8F%91%E6%95%B0%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0" data-v-50f4d550><div><h1 id="并发数及数据存储性能评估" tabindex="-1">并发数及数据存储性能评估 <a class="header-anchor" href="#并发数及数据存储性能评估" aria-label="Permalink to &quot;并发数及数据存储性能评估&quot;">​</a></h1><h2 id="项目背景" tabindex="-1">项目背景 <a class="header-anchor" href="#项目背景" aria-label="Permalink to &quot;项目背景&quot;">​</a></h2><p>空间位置融合应用<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>接收人、车、船、物等对象的各种位置数据，通过拟合纠偏算法进行时空融合统一解算，解算出人、车、船、物等对象的准确位置，结合地图提供目标实时位置展示、锁定追踪、移动路线查询等功能。</p><p>我负责其中原始定位设备接入模块的设计以及开发工作，在前期设备和技术方案预研阶段，设想接入的设备类型众多，并且定位的数据量巨大。因此在设计阶段即需要充分考虑了这些问题，程序通过支持集群部署，多线程消费，应用缓存和表分区存储等技术手段来满足应用需求，其中涉及的技术实现，数据模拟/接入过程等本文只会略微带过，但是不做展开介绍，以后有缘再叙。</p><p>本文探索的重心是思考和介绍在高并发、大容量存储场景中，如何去统计分析相关的并发数量，处理耗时以及存储容量等性能参数，通过精确的数值来充分评估程序的性能参数，还有可能存在的安全隐患和规避策略。</p><h2 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h2><h3 id="基础工具" tabindex="-1">基础工具 <a class="header-anchor" href="#基础工具" aria-label="Permalink to &quot;基础工具&quot;">​</a></h3><p>在数据统计分析过程中，除了安装完平台以外，还需要用到一些数据库和MQ的连接工具以及基础的统一技术架构的解密工具，其中关于如何连接使用工具将不做赘述。</p><ul><li>数据库连接工具：DBeaver</li><li>SSH终端工具：MobaXterm</li></ul><h3 id="平台信息" tabindex="-1">平台信息 <a class="header-anchor" href="#平台信息" aria-label="Permalink to &quot;平台信息&quot;">​</a></h3><p>基础平台的构架版本以及涉及到数据接入的核心组件的版本等信息，基于“域见”构架（isecure），V2.2.4版本的<strong>iSecure Center-Port（港口数字化管理平台）V2.1.0 产品</strong>为基础测试平台。</p><ul><li>域见构架 <sup>isecure</sup> V2.2.4.20230630112137</li><li>事件转发联动服务 <sup>ESC</sup> V2.6.1.20230621112358</li><li>设备接入框架 <sup>DAC</sup> V1.16.100.20230620171622</li><li>智能接入组件 <sup>IAC</sup> V1.16.100.20230620071957</li><li>空间位置融合应用 <sup>SLF</sup> V1.0.0.20240730114405</li></ul><h3 id="测试环境信息" tabindex="-1">测试环境信息 <a class="header-anchor" href="#测试环境信息" aria-label="Permalink to &quot;测试环境信息&quot;">​</a></h3><p>本次测试部署了两台虚拟机服务器，分别是10.67.187.248和10.67.187.245。</p><p><img src="/yzp-blog/assets/%E7%A1%AC%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF.DlY-ee0c.png" alt="image-20240730143113558"></p><blockquote><p><strong>📌 备注</strong></p><p>两台虚拟机配置基本一样，因此接下来都以10.67.187.245进行参数说明以及测试验证，理论上248的参数及性能几乎无异。</p></blockquote><p>10.67.187.245服务器的CPU以及内存配置信息大致如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@HikvisionOS /]# lscpu ⏎</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Architecture:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          x86_64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> op-mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        32-bit,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 64-bit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Byte</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Order:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Little</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):                24</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On-line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">list:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0-23</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Thread(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) per core:    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Core(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) per socket:    12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Socket(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):             2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NUMA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             GenuineIntel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> family:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                 94</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Intel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Processor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Skylake)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Stepping:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MHz:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               2199.998</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BogoMIPS:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              4399.99</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Virtualization:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        VT-x</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hypervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     KVM</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Virtualization</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   full</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L1d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             32K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L1i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             32K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              4096K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NUMA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0-23</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Flags:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                 fpu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> de</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pae</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cx8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mtrr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mca</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cmov</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pse36</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clflush</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mmx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fxsr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sse2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ss</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ht</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> syscall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pdpe1gb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rdtscp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> constant_tsc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rep_good</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nopl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eagerfpu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pni</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pclmulqdq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vmx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ssse3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cx16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pcid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sse4_1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sse4_2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x2apic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> movbe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> popcnt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsc_deadline_timer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xsave</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f16c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rdrand</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hypervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lahf_lm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3dnowprefetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> invpcid_single</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tpr_shadow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vnmi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flexpriority</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ept</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vpid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fsgsbase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsc_adjust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bmi1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> smep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bmi2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> erms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> invpcid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rtm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx512f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx512dq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rdseed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> smap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clflushopt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx512cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx512bw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avx512vl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xsaveopt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xsavec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xgetbv1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pku</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ospke</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@HikvisionOS /]# free -h ⏎</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        free</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      shared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  buff/cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   available</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Mem:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            62G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        3.8G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         49G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         33M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        9.4G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         58G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Swap:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            0B</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          0B</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          0B</span></span></code></pre></div><p>从以上信息基本可以得到以下几点硬件配置信息：</p><ul><li>这是一台通过KVM<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>技术虚出来的虚拟机；</li><li>CPU频率约为2G赫兹；</li><li>逻辑CPU线程数量为24个（虚拟CPU的处理性能相较于物理机会差一些）；</li><li>服务内存约为62GB；</li></ul><h2 id="定位服务设计原理" tabindex="-1">定位服务设计原理 <a class="header-anchor" href="#定位服务设计原理" aria-label="Permalink to &quot;定位服务设计原理&quot;">​</a></h2><h3 id="总体框架" tabindex="-1">总体框架 <a class="header-anchor" href="#总体框架" aria-label="Permalink to &quot;总体框架&quot;">​</a></h3><p>首先大致介绍一下整体数据接入框架，下图罗列出了涉及的主要组件服务。</p><p><img src="/yzp-blog/assets/%E5%AE%9A%E4%BD%8D%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B.C9LivSEs.png" alt=""></p><p>平台通过SDMC组件增删改管理设备信息，添加的设备会将对应的设备信息，事件类型，能力集，数据目标以及数据管道等信息下发给DAC设备接入框架和IAC智能接入框架（统称“接入框架”）。</p><p>接入框架根据设备的配置信息，加载对应的驱动用于连接设备以及接入事件数据，之后解析事件数据为事件报文转发给对应的数据目标。其中DAC约定的事件上报数据目标为RabbitMQ，默认交换机为：<code>dem.demqueue.queue.device_event</code>；IAC约定事件上报数据目标为RabbitMQ，默认交换机为：<code>dem.demqueue.queue.intelligent_event </code>。</p><h3 id="数据接入流程" tabindex="-1">数据接入流程 <a class="header-anchor" href="#数据接入流程" aria-label="Permalink to &quot;数据接入流程&quot;">​</a></h3><p>接上文接入框架将事件推送到数据目标RabbitMQ中之后，ESC事件服务消费数据目标中的设备事件，并且根据订阅逻辑进行消息分发。</p><p>定位接入服务初始化安装首次启动后，默认会向ESC下发定位事件订阅，订阅的交换机为：<code>uls.uls_data_entry.esc_event</code>。之后即可接收到ESC分发的目标类型事件，然后存储到PostgreSQL数据库中（注：存储方式预留了轻量化存储和大数据存储两种）。</p><p><img src="/yzp-blog/assets/%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85%E5%85%A5%E5%BA%93%E6%97%B6%E5%BA%8F.CyZLjzpX.png" alt=""></p><h3 id="多线程消费" tabindex="-1">多线程消费 <a class="header-anchor" href="#多线程消费" aria-label="Permalink to &quot;多线程消费&quot;">​</a></h3><p>定位接入服务中通过RabbitMQ消息中间件接入事件，在程序中即通过<a href="https://spring.io/projects/spring-amqp" target="_blank" rel="noreferrer">Spring AMQP</a>的<code>@RabbitListener</code>注解实现数据消费。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 通用ESC订阅事件消费</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RabbitListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bindings</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueueBinding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">durable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		exchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Exchange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Constants.ESC_EVENT_SUBSCRIPTION_EXCHANGE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ExchangeTypes.FANOUT)),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		messageConverter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;myJackson2JsonMessageConverter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">concurrency</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${slf-data-entry.rabbitmq.listener.concurrency.esc-location-event:5}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RawEventMessageDTO msg) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDebugEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RawEventMessageDTO:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, JSONUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toJsonStr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	/*&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;仅作为参考，此处省略若干其余代码&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>定位消息特别多，一个消费者吭哧吭哧的消费太慢，但是我们的机器性能又杠杠的，这个时候我就希望能够并行消费，相当于同时有多个消费者来处理数据，此时通过设置<code>concurrency</code>参数即可。另外为了满足程序在集群部署场景中的数据消费需求，不发生重复消费或者漏消费等情况，需要保证<code>@Queue</code>的<code>value</code>值保持一致。</p><p>这时候肯定有小伙伴会有疑惑：这个并行线程数设置多少比较合理呢？稍安勿躁，之后的章节会有答案。</p><blockquote><p><strong>📌 备注</strong></p><p>关于多线程消费这块，很多小伙伴习惯或者喜欢或者执着于自己在消费函数内部通过异步线程的方式实现，但是我觉得这种方式增加了代码复杂度的同时，还带来了线程管理不利引发程序奔溃的风险。既然已经有更成熟的方式，为什么不用呢？当然，这个仁者见仁，智者见智。</p></blockquote><h3 id="数据处理模板" tabindex="-1">数据处理模板 <a class="header-anchor" href="#数据处理模板" aria-label="Permalink to &quot;数据处理模板&quot;">​</a></h3><p>从<code>@RabbitListener</code>监听函数收到事件消息后，通过<code>TransactionHandle</code>接口进行统一的处理。该接口类抽象为：<code>start</code>、<code>parseMessage</code>、<code>handleMessage</code>、<code>end</code>四个接口，然后定义通用的处理模板类<code>TransactionDirector</code>规范数据处理过程。</p><p><img src="/yzp-blog/assets/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E9%80%9A%E7%94%A8%E6%B5%81%E7%A8%8B.CmU8Y050.png" alt=""></p><p>具体业务数据消费实现接口和注入模板即可实现统一的数据消费处理过程，这样一来的好处是规范了消息处理流程的同时，还可以在<code>end</code>函数中统一进行打印耗时，事件报文等操作。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 结束执行，计算耗时</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> startTime</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 一次处理流程耗费的时长</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date startTime, List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LocationDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rMessage) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDebugEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Message time：{} milliseconds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, DateUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">between</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(startTime, DateUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), DateUnit.MS));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Message Str : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, JSONUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">formatJsonStr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(transactionHandleHelp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseStr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rMessage)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>千万别忽略了此处的日志打印，对于之后的问题排查以及消费性能评估起到了至关重要的作用。</p><blockquote><p><strong>📌 知识小拓展</strong></p><p>此处隐藏了一个编码的小技巧：通过<code>if (log.isDebugEnabled())</code>判断，可规避掉没有必要的DEBUG操作耗时，在一定程度上提高了程序性能。比如上文示例代码中<code>log.debug</code>打印中的<code>JSONUtil.formatJsonStr</code>日志转换操作其实都会有一定的运行耗时。</p></blockquote><h3 id="定位数据表" tabindex="-1">定位数据表 <a class="header-anchor" href="#定位数据表" aria-label="Permalink to &quot;定位数据表&quot;">​</a></h3><p>经过解析处理之后得到统一的内部私有协议数据对象表<code>source_location_current</code>进行结构化PostgreSQL数据存储。为了提高存取效率，本次设计支持PostgreSQL按天进行分区方式进行分表存储。</p><p><img src="/yzp-blog/assets/%E5%8E%9F%E5%A7%8B%E5%AE%9A%E4%BD%8D%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%BB%93%E6%9E%84.C2iozb_o.png" alt=""></p><p>PostgreSQL的分表存储，采用内置的分区表PARTITION机制（PostgreSQL10开始支持）。PostgreSQL11可实现3种表分区：范围分区（RANGE），列表分区（LIST ）和哈希分区（HASH）。基于定位数据的特征，使用范围分区机制按天对数据进行分区存储。</p><p>基本的语法参考，以及分区形式存储的定位数据示例如下：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建主表，通过RANGE分区</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> measurement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    city_id         </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logdate         </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    peaktemp        </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    unitsales       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> BY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> RANGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (logdate);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建分区表1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> measurement_y2006m02</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PARTITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OF measurement</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    FOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VALUES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2006-02-01&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2006-03-01&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建分区表2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> measurement_y2006m03</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PARTITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OF measurement</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    FOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VALUES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2006-03-01&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2006-04-01&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><img src="/yzp-blog/assets/%E5%8E%9F%E5%A7%8B%E5%AE%9A%E4%BD%8D%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%88%86%E5%8C%BA%E7%BB%93%E6%9E%84.uEVv7ZOQ.png" alt=""></p><h2 id="事件接入性能评估" tabindex="-1">事件接入性能评估 <a class="header-anchor" href="#事件接入性能评估" aria-label="Permalink to &quot;事件接入性能评估&quot;">​</a></h2><p>本文展示的测试数据主要来源于阡陌路上的一台匿名雷视设备，日平均数据量三百万左右。</p><p>待组件运行正常，且保证平台能够正确接入模拟数据后，即开始测试以及评估服务的并发数和存储性能。</p><h3 id="消费性能估算" tabindex="-1">消费性能估算 <a class="header-anchor" href="#消费性能估算" aria-label="Permalink to &quot;消费性能估算&quot;">​</a></h3><p>结合”<a href="#数据处理模板">数据处理模板</a>“章节预留的日志打印，通过<code>tail</code>指令打印日志（可结合<code>grep</code>过滤目标日志），取若干时刻打印数据消费的DEBUG日志（以下日志仅提取关键信息，剔除若干）用以分析事件消费基本耗时。</p><blockquote><p><strong>📌 备注</strong></p><p>需要运管修改组件日志打印等级为&quot;TRACE及以上&quot;，或者通过修改<code>logback.xml</code>增加<code>logger</code>日志打印方式。切记调试完毕还原修改，否则大量的事件报文打印存在安全隐患。</p></blockquote><p>2024-07-30 13:57左右实际耗时日志打印如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@HikvisionOS slf-data-entry]# tail -f slf.slf-data-entry.debug.log </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Message time&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ⏎</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:45.669+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:45.672+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:45.948+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.160+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：27 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.400+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：15 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.499+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：12 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.537+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.752+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：14 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:46.798+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.060+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.095+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.156+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.301+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.456+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：19 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.655+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.707+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.718+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：14 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:47.956+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.026+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：12 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.273+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：12 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.366+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.426+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.619+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.724+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:48.958+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.010+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.067+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.324+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.435+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：13 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.686+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.732+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:49.842+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.187+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.240+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.538+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.643+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.688+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:50.945+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.047+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.296+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.453+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：14 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.547+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：18 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.748+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:51.846+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:52.249+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:52.305+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:52.511+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:52.653+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:52.752+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:53.158+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:53.251+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:53.298+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：38 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:53.569+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T13:57:53.611+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：8 milliseconds</span></span></code></pre></div><p>2024-07-30 14:45左右实际耗时日志打印如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@HikvisionOS slf-data-entry]# tail -f slf.slf-data-entry.debug.log </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Message time&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ⏎</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:39.804+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.001+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.051+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.300+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.496+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.643+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.694+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:40.798+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:41.149+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:41.251+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:41.504+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：3 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:41.508+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:41.613+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.013+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.118+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.219+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.327+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：12 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.424+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.822+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:42.869+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.022+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：8 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.124+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.227+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.476+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.523+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：3 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.780+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.924+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:43.939+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：7 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.276+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：3 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.278+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.483+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.638+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.684+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:44.986+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.090+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.285+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.437+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.439+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.850+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：11 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:45.902+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:46.240+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:46.301+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：9 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:46.302+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：10 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:46.698+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:46.799+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.011+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：20 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.099+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.154+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.458+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.602+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.861+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：3 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.907+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:47.910+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:48.264+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-1]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:48.407+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-5]- Message time：4 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:48.614+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-4]- Message time：6 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:48.677+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-3]- Message time：5 milliseconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2024-07-30T14:45:48.819+08:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [slf.slf_data_entry_queue.esc.location_event-2]- Message time：4 milliseconds</span></span></code></pre></div><p>从以上日志可以大概评估一条事件报文的消费耗时约为10毫秒左右，并且可以明显看出程序默认启动了<strong>5个消费线程</strong>进行并行消费（<em>注：印证了”<a href="#多线程消费">多线程消费</a>“章节的多线程配置</em>）。</p><p>除此以外，抽取了两千条数据进行统计分析（<em>详见“messageTime2024-07-30_1411.csv”样本数据</em>），得到耗时<strong>平均数值约为7.3毫秒/条</strong>，耗时<strong>众数值为5毫秒/条</strong>（<em>注：此处统计分析通过EXCEL实现，分别使用了<code>AVERAGE</code>和<code>MODE</code>函数</em>）。</p><blockquote><p><strong>💣 特别备注</strong></p><p>此日志打印只能说明数据在消费函数内部执行的耗时，原则上还存在Spring AMQP框架内部接收、解析、线程管理、成功回调等一系列操作的耗时，但是这部分耗时暂未找到方法进行精确评估，所以以下公式中于预设定默认100%的冗余量，是否足够存疑！</p></blockquote><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mrow><mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">/</mi><mn>2</mn><mn>4</mn><mi mathvariant="normal">H</mi></mtext></mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><mn>4</mn><mi>H</mi><mo>×</mo><mn>6</mn><mn>0</mn><mi>M</mi><mo>×</mo><mn>6</mn><mn>0</mn><mi>S</mi><mo>×</mo><mn>1</mn><mn>0</mn><mn>0</mn><mn>0</mn><mi>M</mi><mi>S</mi></mrow><mrow><mn>7</mn><mi mathvariant="normal">.</mi><mn>3</mn><mi>M</mi><mi>S</mi><mo>×</mo><mn>2</mn><mi>R</mi></mrow></mfrac></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>≈</mo><mrow><mn>5</mn><mo separator="true">,</mo><mn>9</mn><mn>1</mn><mn>7</mn><mo separator="true">,</mo><mn>8</mn><mn>0</mn><mn>8</mn></mrow></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned} {\text{Count/24H}}&amp;=\frac{24H\times60M\times60S\times1000MS}{7.3MS\times2R}\\ \\ &amp; \approx{5,917,808} \end{aligned} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.5148300000000003em;"></span><span class="strut bottom" style="height:4.52966em;vertical-align:-2.01483em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-1.1545000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">C</span><span class="mord mathrm">o</span><span class="mord mathrm">u</span><span class="mord mathrm">n</span><span class="mord mathrm">t</span><span class="mord mathrm">/</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mord mathrm">H</span></span></span></span></span><span style="top:0.4548299999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.6548299999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-1.1545000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">7</span><span class="mord mathrm">.</span><span class="mord mathrm">3</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mbin">×</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mbin">×</span><span class="mord mathrm">6</span><span class="mord mathrm">0</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin">×</span><span class="mord mathrm">6</span><span class="mord mathrm">0</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mbin">×</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span><span style="top:1.654829999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">≈</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">9</span><span class="mord mathrm">1</span><span class="mord mathrm">7</span><span class="mpunct">,</span><span class="mord mathrm">8</span><span class="mord mathrm">0</span><span class="mord mathrm">8</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p><p>根据以上统计数据即可大致评估计算出<strong>单线程24H的消费能力上限约为六百万条</strong>。</p><blockquote><p><strong>📌 备注</strong></p><p>冗余量即为了增强系统的可靠性和安全性，在平均值的基础上预留一定耗时冗余，以应对可能发生的故障、卡顿或不可估因素等问题。</p></blockquote><p>结合测试服务器24核CPU物理配置情况进行估算程序的并行线程数（<em>注：前提是服务器仅部署用于数据消费程序使用</em>），一般可用线程数为2倍CPU（<em>注：可参考“<a href="https://www.cnblogs.com/dennyzhangdd/p/6909771.html" target="_blank" rel="noreferrer">根据CPU核心数确定线程池并发线程数 </a>”科普文章</em>）。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>y</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mn>2</mn><mn>4</mn><mi>C</mi><mi>P</mi><mi>U</mi><mo>×</mo><mn>2</mn><mi>N</mi><mo>×</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>≈</mo><mn>2</mn><mn>8</mn></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned} Concurrency &amp;= 24CPU\times2N\times0.6\\ \\ &amp;\approx 28 \end{aligned} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05em;"></span><span class="strut bottom" style="height:3.6000000000000005em;vertical-align:-1.5500000000000007em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mbin">×</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mbin">×</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">6</span></span></span><span style="top:1.1900000000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">≈</span><span class="mord mathrm">2</span><span class="mord mathrm">8</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p><p>另外考虑其他程序占用问题，默认供程序可用线程数为60%，即可估算出<strong>安全的并发线程数为28</strong>（<em>注：程序在该并发数下测试验证消费平均耗时与上文5个并发数得到的计算值几乎无异</em>）。此处也就解答了”<a href="#多线程消费">多线程消费</a>“章节对于程序并行线程数设置的疑问。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>2</mn><mn>4</mn><mi>H</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mn>5</mn><mo separator="true">,</mo><mn>9</mn><mn>1</mn><mn>7</mn><mo separator="true">,</mo><mn>8</mn><mn>0</mn><mn>8</mn><mo>×</mo><mn>2</mn><mn>8</mn></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>≈</mo><mn>1</mn><mn>6</mn><mn>5</mn><mo separator="true">,</mo><mn>6</mn><mn>9</mn><mn>8</mn><mo separator="true">,</mo><mn>6</mn><mn>2</mn><mn>4</mn></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned} Count/24H&amp;=5,917,808\times28\\\\ &amp;\approx165,698,624 \end{aligned} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05em;"></span><span class="strut bottom" style="height:3.6000000000000005em;vertical-align:-1.5500000000000007em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathrm">/</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">9</span><span class="mord mathrm">1</span><span class="mord mathrm">7</span><span class="mpunct">,</span><span class="mord mathrm">8</span><span class="mord mathrm">0</span><span class="mord mathrm">8</span><span class="mbin">×</span><span class="mord mathrm">2</span><span class="mord mathrm">8</span></span></span><span style="top:1.1900000000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">≈</span><span class="mord mathrm">1</span><span class="mord mathrm">6</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">6</span><span class="mord mathrm">9</span><span class="mord mathrm">8</span><span class="mpunct">,</span><span class="mord mathrm">6</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p><p>通过单线程24H的消费能力以及基础硬件配置，即可大概评估计算出程序 <strong>一台服务器24H的理论消费能力上限约为1.6亿条</strong>。</p><h3 id="轻量化存储性能估算" tabindex="-1">轻量化存储性能估算 <a class="header-anchor" href="#轻量化存储性能估算" aria-label="Permalink to &quot;轻量化存储性能估算&quot;">​</a></h3><p>定位事件表按天进行分区，所以理论上存储的时间颗粒度最小为“天”，进行统计分析时候即可以通过时间进行条件过滤以及关联查询。</p><p>为了评估表数据的存储性能，即需要计算获得单条表数据的平均存储空间，以及结合每天的数据入库数量进行乘积计算，计算公式如下。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>T</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mo>=</mo><mover accent="true"><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><mo>¯</mo></mover><mo>×</mo><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">StorageTotal=\bar{Storage} \times Count </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8201099999999999em;"></span><span class="strut bottom" style="height:1.0145499999999998em;vertical-align:-0.19444em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mrel">=</span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span></span></span><span style="top:-0.25233em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>¯</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">n</span><span class="mord mathit">t</span></span></span></span></span></p><p>结合以上公式以及分区存储形式，通过测试入库的数据即可计算出单条数据存储空间值的算数平均值计算公式。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mover accent="true"><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><mo>¯</mo></mover></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mo>(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>+</mo><msub><mi>X</mi><mn>2</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>X</mi><mi>n</mi></msub><mo>)</mo></mrow><mrow><mi>n</mi></mrow></mfrac></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>X</mi><mi>i</mi></msub></mrow><mrow><mi>n</mi></mrow></mfrac></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned} \bar{Storage}&amp;=\frac{(X_1+X_2+...+X_n)}{n}\\\\ &amp;=\frac{\sum\limits_{i=1}^n X_i}{n} \end{aligned} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:3.609033em;"></span><span class="strut bottom" style="height:6.718066em;vertical-align:-3.109033em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-2.182033em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span></span></span><span style="top:-0.25233em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>¯</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:-0.6560329999999996em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:2.423033em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-2.182033em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span><span style="top:2.423033em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-1.3676689999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:0.8776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.000005000000000088267em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol small-op mop">∑</span></span></span><span style="top:-0.9500050000000002em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p><p><code>Xn</code>表示按天统计计算得到的单条平均存储值，<code>n</code>表示天数。</p><p><code>PostgreSQL</code>可以通过<code>information_schema.tables</code>查询每个表分区（每天）的存储占用情况，统计sql语句如下。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;表名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	pg_size_pretty(pg_relation_size(quote_ident(table_schema) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> quote_ident(table_name))) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;占用存储空间&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tables</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;public&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source_location_current_%&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">order by</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>通过该统计语句查询测试环境的实际数据占用空间情况如下。</p><p><img src="/yzp-blog/assets/sql%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E8%A1%A8%E5%88%86%E5%8C%BA%E5%8D%A0%E7%94%A8%E5%AD%98%E5%82%A8.CT2ty_av.png" alt="image-20240731101125883"></p><p>有了每个表分区24H的存储占用空间信息，再结合分区表的数据量，即可大致评估计算出每天/单条事件的存储容量，通过<code>pg_catalog.pg_class</code>可以查询每个表分区（每天）的数据量情况，分区数据量的统计sql语句以及结果如下。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;表名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	reltuples::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;数据量&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	pg_catalog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pg_class</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source_location_current_________&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> order by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><img src="/yzp-blog/assets/sql%E7%BB%9F%E8%AE%A1%E8%A1%A8%E5%88%86%E5%8C%BA%E6%95%B0%E6%8D%AE%E9%87%8F.DkdjZDwP.png" alt="image-20240731101027512"></p><blockquote><p><strong>📌 知识小拓展</strong></p><p>实际应用中发现存在查询得到的分区表数据量为0的情况，需要通过<code>analyse</code>语法进行手动刷新。具体可以参考”<a href="https://blog.csdn.net/qq_40985985/article/details/128835076" target="_blank" rel="noreferrer">Postgresql pg_class查看所有表名relname及记录数reltuples，记录数显示0实际有数据解决</a>“博客。</p></blockquote><p>然后对以上两块数据通过时间进行关联查询，即可得到每个分区表单条数据的平均占用空间，统计sql语句以及结果如下：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	t1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;表名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	t2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">row_count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;数据量&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	t1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;占用存储空间（KB）&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">t1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">row_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">numeric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;单条数据占用空间（KB）&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		table_name, (pg_relation_size(quote_ident(table_schema) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> quote_ident(table_name))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	from</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tables</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;public&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source_location_current_%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) t1,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	select</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name, reltuples::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> row_count</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	from</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		pg_class</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	where</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source_location_current_%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) t2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	t1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">table_name</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">row_count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">order by</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	t1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><img src="/yzp-blog/assets/sql%E7%BB%9F%E8%AE%A1%E5%88%86%E5%8C%BA%E5%8D%95%E6%9D%A1%E8%A1%A8%E6%95%B0%E6%8D%AE%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4.C8KiJobd.png" alt="image-20240731103008354"></p><p>因此即可按天查询得到分区表的单条数据占用空间（KB），根据算数平均值计算公式，计算得到<strong>单条事件存储容量约为1.1KB</strong>。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi mathvariant="normal">/</mi><mn>2</mn><mn>4</mn><mi>H</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>1</mn><mi>K</mi><mi>B</mi><mo>×</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>×</mo><mn>1</mn><mn>6</mn><mn>5</mn><mn>6</mn><mn>9</mn><mn>8</mn><mn>6</mn><mn>2</mn><mn>4</mn></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mo>≈</mo><mn>2</mn><mn>6</mn><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>3</mn><mn>7</mn><mn>1</mn><mn>6</mn><mn>1</mn><mn>3</mn><mi>G</mi><mi>B</mi></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned} Storage/24H&amp;=1.1KB\times1.5\times165698624\\\\ &amp; \approx 260.7371613GB \end{aligned} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05em;"></span><span class="strut bottom" style="height:3.6000000000000005em;vertical-align:-1.5500000000000007em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathrm">/</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">1</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mbin">×</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mbin">×</span><span class="mord mathrm">1</span><span class="mord mathrm">6</span><span class="mord mathrm">5</span><span class="mord mathrm">6</span><span class="mord mathrm">9</span><span class="mord mathrm">8</span><span class="mord mathrm">6</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span></span></span><span style="top:1.1900000000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">≈</span><span class="mord mathrm">2</span><span class="mord mathrm">6</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">7</span><span class="mord mathrm">3</span><span class="mord mathrm">7</span><span class="mord mathrm">1</span><span class="mord mathrm">6</span><span class="mord mathrm">1</span><span class="mord mathrm">3</span><span class="mord mathit">G</span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span></p><p>最后按照50%的冗余量进行计算，可以得到<strong>一台服务器/24H接入的存储容量上限约为260GB</strong>。</p><h3 id="分析结果" tabindex="-1">分析结果 <a class="header-anchor" href="#分析结果" aria-label="Permalink to &quot;分析结果&quot;">​</a></h3><p>根据以上数据性能评估，总结得到如下几个性能参数（<em>注：以下数据在计算过程中均考虑了冗余量</em>）：</p><ul><li>单线程、单条事件报文平均消费耗时约为<strong>7.3毫秒</strong>，单线程24小时的消费能力上限约为<strong>600万条</strong>；</li><li>以24核CPU，62GB内存服务器为例，设置<strong>28并发</strong>消费线程数，一台服务器/24H的理论消费能力上限约为<strong>1.6亿条</strong>；</li><li>PostgreSQL轻量化存储场景，单条事件存储容量约为<strong>1.1KB</strong>，一台服务器/24H接入的存储容量上限约为<strong>260GB</strong>；</li></ul><h2 id="知识点总结" tabindex="-1">知识点总结 <a class="header-anchor" href="#知识点总结" aria-label="Permalink to &quot;知识点总结&quot;">​</a></h2><h3 id="知识点1-若干常用linux服务器指令" tabindex="-1">知识点1：若干常用Linux服务器指令 <a class="header-anchor" href="#知识点1-若干常用linux服务器指令" aria-label="Permalink to &quot;知识点1：若干常用Linux服务器指令&quot;">​</a></h3><ul><li>查看服务器基本系统信息指令：<code>lscpu</code>；</li><li>查看服务器内存使用情况：<code>free -h</code>；</li><li>查看当前服务器CPU使用情况：<code>top -c</code>，想要查看各个CPU内核使用状况，继续按1；</li><li>日志实时打印指令：<code>tail -f</code>，示例：<code>tail -f slf.slf-data-entry.debug.log |grep &#39;Message time&#39;</code>，可以结合<code>grep</code>进行关键字过滤，；</li><li>根据关键字日志提取指令：<code>cat</code> ，示例：<code>cat slf.slf-data-entry.debug.log | grep &#39;Message time&#39; &gt; output.txt</code>；</li></ul><h3 id="知识点2-配置rabbitmq多线程消费" tabindex="-1">知识点2：配置RabbitMQ多线程消费 <a class="header-anchor" href="#知识点2-配置rabbitmq多线程消费" aria-label="Permalink to &quot;知识点2：配置RabbitMQ多线程消费&quot;">​</a></h3><p>通过配置<code>@RabbitListener</code>的<code>concurrency</code>参数实现并行消费，需要注意这个参数不是越大越好，需要结合实际服务器的硬件资源进行合理分配，注解参考示例如下。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RabbitListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bindings</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueueBinding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">durable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		exchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Exchange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Constants.ESC_EVENT_SUBSCRIPTION_EXCHANGE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ExchangeTypes.FANOUT)),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		messageConverter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;myJackson2JsonMessageConverter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">concurrency</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${slf-data-entry.rabbitmq.listener.concurrency.esc-location-event:5}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>另外拓展看下这个参数的源码注解，可以发现除了配置固定的消费线程数以外，还可以通过<code>&quot;m-n&quot;</code>格式分别配置<code>concurrentConsumers</code>和<code>maxConcurrentConsumers</code>，可以简单理解成就是消费线程池的核心线程数与最大线程数。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Set the concurrency of the listener container for this listener. Overrides the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * default set by the listener container factory. Maps to the concurrency setting of</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * the container type.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;For a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * {@link org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * SimpleMessageListenerContainer} if this value is a simple integer, it sets a fixed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * number of consumers in the {@code concurrentConsumers} property. If it is a string</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * with the form {@code &quot;m-n&quot;}, the {@code concurrentConsumers} is set to {@code m}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * and the {@code maxConcurrentConsumers} is set to {@code n}.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;For a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * {@link org.springframework.amqp.rabbit.listener.DirectMessageListenerContainer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * DirectMessageListenerContainer} it sets the {@code consumersPerQueue} property.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> the concurrency.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@since</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 2.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concurrency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="知识点3-postgresql分区存储" tabindex="-1">知识点3：PostgreSQL分区存储 <a class="header-anchor" href="#知识点3-postgresql分区存储" aria-label="Permalink to &quot;知识点3：PostgreSQL分区存储&quot;">​</a></h3><p>PostgreSQL10开始支持分区表PARTITION机制。分区指的是将逻辑上的一个大表分成更小的物理块。PostgreSQL11可实现3种表分区：范围分区（RANGE），列表分区（LIST ）和哈希分区（HASH）。分区可以提供几个好处：</p><ul><li>在某些情况下，查询性能可以得到显著提高，特别是当表中大多数访问量很大的行位于单个分区或少量分区中时。分区有效地替代了索引的上层树级别，使得索引中频繁使用的部分更有可能适合内存。</li><li>当查询或更新访问单个分区的很大一部分时，可以通过对该分区进行顺序扫描而不是使用索引来提高性能，因为索引需要在整个表中分散进行随机访问读取。</li><li>如果在分区设计中考虑了使用模式，则可以通过添加或删除分区来完成批量加载和删除。使用<code>DROP TABLE</code>删除单个分区，或者执行<code>ER TABLE DETACH partition</code>，要比批量操作快得多。这些命令还完全避免了批量DELETE操作造成的VACUUM开销。</li><li>很少使用的数据可以迁移到更便宜和更慢的存储介质上。</li></ul><p>以上摘自PostgreSQL官网”<a href="https://www.postgresql.org/docs/11/ddl-partitioning.html" target="_blank" rel="noreferrer">5.10. Table Partitioning</a>“，感兴趣或者用得着的小伙伴直接去官网逛逛吧。</p><h3 id="知识点4-性能估算的若干指标项" tabindex="-1">知识点4：性能估算的若干指标项 <a class="header-anchor" href="#知识点4-性能估算的若干指标项" aria-label="Permalink to &quot;知识点4：性能估算的若干指标项&quot;">​</a></h3><p>对程序进行性能评估，少不了统计单位程序对单位数据的<strong>处理耗时</strong>，<strong>消耗内存</strong>，<strong>硬盘存储</strong>等信息，并且结合可视化打印和统计分析手段，计算获得<strong>数据量</strong>、<strong>平均值</strong>以及<strong>众数</strong>等体现具体程序数量级的参数。</p><p>另外我们在进行公式计算的过程中，需要充分考虑<strong>冗余量</strong>指标，使得最终计算得到的数据更加接近实际生产场景和提前预留风险值。</p><h2 id="结束语" tabindex="-1">结束语 <a class="header-anchor" href="#结束语" aria-label="Permalink to &quot;结束语&quot;">​</a></h2><p>通过统计分析得到的程序性能参数让我感到十分意外和惊讶，因为整个消费能力以及数量级远超我的预期。当然，不排除其中统计分析手段或者参数公式等存在错误的可能，希望发现了的小伙伴能够及时指正，欢迎各抒己见。</p><p>最后的最后，祝你生活愉快，盆友~<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>空间位置融合应用接收人、车、船、物等对象的各种位置数据，通过拟合纠偏算法进行时空融合统一解算，解算出人、车、船、物等对象的准确位置，结合地图提供目标实时位置展示、锁定追踪、移动路线查询等功能。 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>KVM(Kernel-Based Virtual Machines)是一个基于Linux内核的虚拟化技术, 可以直接将Linux内核转换为Hypervisor（系统管理程序）从而使得Linux内核能够直接管理虚拟机, 直接调用Linux内核中的内存管理、进程管理子系统来管理虚拟机。 <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>“多言数穷，不如守中。”---created by 袁志鹏 on 五月 28,2024 edited by 袁志鹏 on 八月 1,2024 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li></ol></section></div></div></main><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-cabb9229 data-v-694a52f9><div class="container" data-v-694a52f9><p class="message" data-v-694a52f9>基于 MIT 许可发布</p><p class="copyright" data-v-694a52f9>版权所有 © 2024 袁小猴没有秘密花园</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"B5oFjjvv\",\"readme.md\":\"B8VbrYSF\",\"工作点滴积累_h5player组件使用浅析.md\":\"lcst3b9z\",\"工作点滴积累_hik视频相关知识备忘录.md\":\"BLBcf9J0\",\"工作点滴积累_一种基于sac和存储设备实现文件（图像、录像）转存的技术方案.md\":\"Wk-AsnmX\",\"工作点滴积累_代码重构系列_代码重构之mq消息对接处理的若干经验浅谈.md\":\"iXWvzavr\",\"工作点滴积累_代码重构系列_代码重构之xfusion条件查询优化的若干经验浅谈.md\":\"DcGGaPME\",\"工作点滴积累_代码重构系列_代码重构之资源缓存设计的若干经验浅谈.md\":\"BFdUJsqh\",\"工作点滴积累_数据统计分析方法探索系列_并发数及数据存储性能评估.md\":\"Eq3lisfK\",\"工作点滴积累_数据统计分析方法探索系列_镇江港皮带机项目.md\":\"Dqe0DElC\",\"工作点滴积累_浅谈系列_浅谈一种事件聚类去重的实现思路.md\":\"BymkXmI9\",\"工作点滴积累_浅谈系列_浅谈代码复杂度的困局.md\":\"IpN4jVnM\",\"工作点滴积累_浅谈系列_浅谈项目习惯性延期的困局.md\":\"CtIOQLmw\",\"工作点滴积累_独立软件（java）设计开发的若干经验浅谈.md\":\"DXch1Vkj\",\"工作点滴积累_统一技术架构下设备及事件接入备忘录.md\":\"BdE9-Zo_\",\"工作点滴积累_自定义视频设备模拟.md\":\"Bm9hsI--\",\"工作点滴积累_软件产品国产化系列_软件产品国产化之phantomjs适配.md\":\"BiBb2V1H\",\"工作点滴积累_软件产品国产化系列_软件产品国产化之初识国产化_iot安装使用笔记.md\":\"BZYawEMC\",\"工作点滴积累_软件产品国产化系列_软件产品国产化之组件和产品适配开发的若干经验浅谈.md\":\"CzDvNf_I\",\"技术类经验分享_dbeaver从入门到牛皮哄哄.md\":\"ZxRQikAs\",\"技术类经验分享_feign实战系列_feign实战之对接云曜开放平台.md\":\"DNoElBsr\",\"技术类经验分享_feign实战系列_feign实战之对接智运开放平台.md\":\"Bn2CdoxZ\",\"技术类经验分享_feign实战系列_通过feign对接isapi协议接口的总结分享.md\":\"DtzJOJ0J\",\"技术类经验分享_frp内网穿透技术功能简介及项目实践.md\":\"DfHPUJ4h\",\"技术类经验分享_rs-232串口通信实战开发_rs-232串口通信实战开发之技术原理篇.md\":\"MplpS61U\",\"技术类经验分享_rs-232串口通信实战开发_rs-232串口通信实战开发之技术选型篇.md\":\"Ce9vEhxM\",\"技术类经验分享_rs-232串口通信实战开发_rs-232串口通信实战开发之项目实战篇.md\":\"BeYnAHMN\",\"技术类经验分享_websocket鉴权的实现思路及原理.md\":\"upUpnMh7\",\"技术类经验分享_一种基于netty-socketio实现的双向实时通信方案.md\":\"D4igoNE6\",\"技术类经验分享_基于mqtt对接第三方平台的开发案例.md\":\"Cl6d8iLK\",\"技术类经验分享_复杂json解析处理的若干经验浅谈.md\":\"Bfq8CHjH\",\"技术类经验分享_实用编程技巧_序.md\":\"Zh3M2FzC\",\"技术类经验分享_记一次通过jna调用c__接口的过程.md\":\"BJHi8voy\",\"读书分享专区_2024年书单.md\":\"DrRVBcgx\",\"读书分享专区_做事的三个层面.md\":\"Bi_SS8S7\",\"读书分享专区_前言.md\":\"Chkhi6Di\",\"读书分享专区_叶底藏花一度，梦里踏雪几回.md\":\"DuDbp3Co\",\"读书分享专区_树洞倾述区_一封絮絮叨叨的信.md\":\"CD6GqZo1\",\"读书分享专区_树洞倾述区_体会二三.md\":\"AE8KBPT4\",\"读书分享专区_树洞倾述区_关于写代码想说的一些话.md\":\"TjoBZ3BS\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-Hans\",\"dir\":\"ltr\",\"title\":\"👽袁小猴没有秘密花园\",\"description\":\" \",\"base\":\"/yzp-blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"主页\",\"link\":\"/\"},{\"text\":\"给我留言\",\"link\":\"https://github.com/15868125643/yzp-blog/issues\"}],\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"主题\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\",\"docFooter\":{\"prev\":false,\"next\":false},\"sidebar\":[{\"text\":\"📚读书&感悟专区\",\"collapsed\":false,\"items\":[{\"text\":\"前言\",\"link\":\"读书分享专区/前言\"},{\"text\":\"（摘）做事的三个层面\",\"link\":\"读书分享专区/做事的三个层面\"},{\"text\":\"（摘）叶底藏花一度，梦里踏雪几回\",\"link\":\"读书分享专区/叶底藏花一度，梦里踏雪几回\"},{\"text\":\"2024年书单\",\"link\":\"读书分享专区/2024年书单\"},{\"text\":\"你好，树洞（慎入）\",\"collapsed\":true,\"items\":[{\"text\":\"一封絮絮叨叨的信\",\"link\":\"读书分享专区/树洞倾述区/一封絮絮叨叨的信\"}]}]},{\"text\":\"🐒技术类经验分享\",\"collapsed\":false,\"items\":[{\"text\":\"技术类经验分享\",\"link\":\"技术类经验分享/实用编程技巧/序\",\"collapsed\":true,\"items\":[{\"text\":\"RabbitMQ消息队列浅析\",\"link\":\"\"},{\"text\":\"优雅的参数校验\",\"link\":\"\"},{\"text\":\"异步和多线程处理\",\"link\":\"\"},{\"text\":\"PG分表数据存取实战\",\"link\":\"\"},{\"text\":\"日志打印的那些破事儿\",\"link\":\"\"},{\"text\":\"妙用EasyPoi实现Excel导入导出\",\"link\":\"\"}]},{\"text\":\"RS-232串口通信实战开发系列\",\"collapsed\":true,\"items\":[{\"text\":\"技术原理篇\",\"link\":\"技术类经验分享/RS-232串口通信实战开发/RS-232串口通信实战开发之技术原理篇\"},{\"text\":\"技术选型篇\",\"link\":\"技术类经验分享/RS-232串口通信实战开发/RS-232串口通信实战开发之技术选型篇\"},{\"text\":\"项目实战篇\",\"link\":\"技术类经验分享/RS-232串口通信实战开发/RS-232串口通信实战开发之项目实战篇\"}]},{\"text\":\"复杂JSON解析处理的若干经验浅谈\",\"link\":\"技术类经验分享//复杂JSON解析处理的若干经验浅谈\"},{\"text\":\"记一次通过JNA调用C++接口的过程\",\"link\":\"技术类经验分享//记一次通过JNA调用C++接口的过程\"},{\"text\":\"Feign实战系列\",\"collapsed\":true,\"items\":[{\"text\":\"通过Feign对接ISAPI协议接口的总结分享\",\"link\":\"技术类经验分享/Feign实战系列/通过Feign对接ISAPI协议接口的总结分享\"},{\"text\":\"对接智运开放平台\",\"link\":\"技术类经验分享/Feign实战系列/Feign实战之对接智运开放平台\"},{\"text\":\"对接云曜开放平台\",\"link\":\"技术类经验分享/Feign实战系列/Feign实战之对接云曜开放平台\"}]},{\"text\":\"基于MQTT对接第三方平台的开发案例\",\"link\":\"技术类经验分享/基于MQTT对接第三方平台的开发案例\"},{\"text\":\"WebSocket鉴权的实现思路及原理\",\"link\":\"技术类经验分享/WebSocket鉴权的实现思路及原理\"},{\"text\":\"一种基于Netty-SocketIO实现双向实时通信的方案\",\"link\":\"技术类经验分享/一种基于Netty-SocketIO实现的双向实时通信方案\"},{\"text\":\"FRP内网穿透技术功能简介及项目实践\",\"link\":\"技术类经验分享/FRP内网穿透技术功能简介及项目实践\"}]},{\"text\":\"💣工作点滴积累\",\"collapsed\":false,\"items\":[{\"text\":\"数据统计分析方法探索\",\"collapsed\":true,\"items\":[{\"text\":\"并发数及数据存储性能评估\",\"link\":\"工作点滴积累/数据统计分析方法探索系列/并发数及数据存储性能评估\"}]},{\"text\":\"代码重构系列\",\"collapsed\":true,\"items\":[{\"text\":\"资源缓存设计的若干经验浅谈\",\"link\":\"工作点滴积累/代码重构系列/代码重构之资源缓存设计的若干经验浅谈\"},{\"text\":\"MQ消息对接处理的若干经验浅谈\",\"link\":\"工作点滴积累/代码重构系列/代码重构之MQ消息对接处理的若干经验浅谈\"}]},{\"text\":\"浅谈系列\",\"collapsed\":true,\"items\":[{\"text\":\"浅谈一种事件聚类去重的实现思路\",\"link\":\"工作点滴积累/浅谈系列/浅谈一种事件聚类去重的实现思路\"},{\"text\":\"浅谈代码复杂度的困局\",\"link\":\"工作点滴积累/浅谈系列/浅谈代码复杂度的困局\"},{\"text\":\"浅谈项目习惯性延期的困局\",\"link\":\"工作点滴积累/浅谈系列/浅谈项目习惯性延期的困局\"}]}]}],\"outline\":{\"label\":\"页面导航\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/15868125643/yzp-blog\"}],\"footer\":{\"message\":\"基于 MIT 许可发布\",\"copyright\":\"版权所有 © 2024 袁小猴没有秘密花园\"},\"search\":{\"provider\":\"local\",\"options\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\",\"closeText\":\"关闭\"}}}}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>